{"version":3,"sources":["webpack://SoundFont/webpack/universalModuleDefinition","webpack://SoundFont/webpack/bootstrap","webpack://SoundFont/./node_modules/@logue/reverb/src/meta.js","webpack://SoundFont/./node_modules/@logue/reverb/src/reverb.js","webpack://SoundFont/./src/meta.js","webpack://SoundFont/./src/riff.js","webpack://SoundFont/./src/sf2.js","webpack://SoundFont/./src/sound_font_synth.js","webpack://SoundFont/./src/sound_font_synth_note.js","webpack://SoundFont/./src/wml.js"],"names":["Meta","version","date","Riff","constructor","input","optParams","ip","index","length","chunkList","offset","padding","bigEndian","parse","parseChunk","size","push","RiffChunk","String","fromCharCode","getChunk","chunk","getNumberOfChunks","type","Parser","parserOption","sampleRate","presetHeader","presetZone","presetZoneModulator","presetZoneGenerator","instrument","instrumentZone","instrumentZoneModulator","instrumentZoneGenerator","sampleHeader","GeneratorEnumeratorTable","parser","Error","parseRiffChunk","data","signature","parseInfoList","parseSdtaList","parsePdtaList","samplingData","parsePhdr","parsePbag","parsePmod","parsePgen","parseInst","parseIbag","parseImod","parseIgen","parseShdr","presetName","apply","subarray","preset","bank","presetBagIndex","library","genre","morphology","presetGeneratorIndex","presetModulatorIndex","parseModulator","parseGenerator","instrumentName","instrumentBagIndex","instrumentGeneratorIndex","instrumentModulatorIndex","samples","sample","sampleName","start","end","startLoop","endLoop","originalPitch","pitchCorrection","sampleLink","sampleType","Int16Array","Uint8Array","buffer","adjust","adjustSampleData","multiply","newSample","i","il","j","code","key","output","value","amount","lo","hi","createInstrument","zone","bagIndex","bagIndexEnd","zoneInfo","instrumentGenerator","instrumentModulator","jl","createInstrumentGenerator_","createInstrumentModulator_","generator","generatorSequence","generatorInfo","modulator","modulatorSequence","modulatorInfo","name","info","createPreset","presetGenerator","presetModulator","createPresetGenerator_","createPresetModulator_","header","modgen","createBagModGen_","modgenInfo","indexStart","indexEnd","zoneModGen","unknown","Synthesizer","bankSet","bufferSize","ctx","getAudioContext","gainMaster","createGain","bufSrc","createBufferSource","channelInstrument","channelBank","channelVolume","channelPanpot","channelPitchBend","channelPitchBendSensitivity","channelExpression","channelAttack","channelDecay","channelSustin","channelRelease","channelHold","channelHarmonicContent","channelCutOffFrequency","isGS","isXG","programSet","channelMute","currentNoteOn","baseVolume","masterVolume","percussionPart","percussionVolume","Array","reverb","filter","Reverb","mix","createBiquadFilter","observer","IntersectionObserver","entries","object","forEach","entry","target","dataset","isIntersecting","window","AudioContext","webkitAudioContext","createGainNode","initAudioContext","document","removeEventListener","emptySource","stop","addEventListener","init","mode","disconnect","createAllInstruments","programChange","volumeChange","panpotChange","pitchBend","pitchBendSensitivity","attackTime","decayTime","sustinTime","releaseTime","harmonicContent","cutOffFrequency","reverbDepth","updateBankSelect","updateProgramSelect","setPercussionPart","connect","destination","element","close","refreshInstruments","presets","instruments","banks","bankNumber","presetNumber","replace","createNoteInfo","keyRange","sampleID","volDelay","getModGenAmount","volAttack","volHold","volDecay","volSustain","volRelease","modDelay","modAttack","modHold","modDecay","modSustain","modRelease","scale","freqVibLFO","pan","tune","sampleId","enumeratorType","optDefault","setMasterVolume","volume","gain","drawSynth","doc","wrapper","createElement","className","instElem","items","eventStart","eventEnd","channel","channelElem","item","hasOwnProperty","call","itemElem","checkboxElement","checkbox","setAttribute","id","synth","mute","checked","appendChild","labelElem","textContent","bankSelect","option","event","bankChange","channelElemInstrument","selectedIndex","select","volumeElem","innerText","pitchSensElem","panpot","min","max","optimum","low","high","pitch","keyElem","n","includes","k","preventDefault","drag","noteOn","noteOff","observe","updateSynthElement","velocity","querySelector","classList","contains","remove","style","opacity","add","toFixed","bankElement","firstChild","removeChild","bankNo","parseInt","slice","bankIndex","programElement","programNo","selected","console","warn","instrumentKey","Math","random","round","note","SynthesizerNote","hold","release","splice","isNoteOff","channelElement","bankSelectMsb","bankSelectLsb","expression","updateExpression","lowerByte","higherByte","bend","calculated","updatePitchBend","sensitivity","depth","modulationDepth","getPitchBendSensitivity","drumInstrumentLevel","allNoteOff","allSoundOff","shift","resetAllControl","sw","playbackRate","loopStart","loopEnd","modEnvToPitch","hermonicContent","startTime","currentTime","computedPlaybackRate","noteOffState","audioBuffer","bufferSource","panner","createPanner","outputGainNode","expressionGainNode","now","createBuffer","channelData","getChannelData","set","loop","panningModel","setPosition","sin","PI","cos","outputGain","setValueAtTime","setTargetAtTime","linearRampToValueAtTime","baseFreq","amountToFreq","peekFreq","sustainFreq","Q","frequency","parseFloat","val","volEndTimeTmp","volEndTime","modEndTime","cancelScheduledValues","error","schedulePlaybackRate","computed","peekPitch","WebMidiLink","NrpnMsb","NrpnLsb","RpnMsb","RpnLsb","ready","loadCallback","messageHandler","onmessage","bind","xhr","rpnMode","cache","placeholder","getElementById","body","opener","build","setup","url","w","onload","load","parent","loading","loadingText","progress","progressBar","role","self","postMessage","promise","Promise","resolve","caches","open","then","match","response","arrayBuffer","stream","catch","fetch","ok","total","headers","get","copy","clone","put","concatenation","segments","sumLength","byteLength","whole","pos","res","reader","getReader","processResult","result","done","percentage","width","read","e","alert","message","loadSoundFont","readyElem","ev","msg","split","command","processMidiMessage","map","hex","setLoadCallback","callback","vendor","device","subId1","subId2","log","dumpMessage","part","ret","toString","toUpperCase","join"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AACA;AACA;AACA;AACA;AACe,mEAAI,EAAC;;;;;;;;;;;;;ACLpB;AAAA;AAAA;AAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,eAAe;AACf;AACe;AACf;AACA;AACA,aAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,+BAA+B;AAC/B,eAAe,OAAO;AACtB,mBAAmB,6CAAI;AACvB,eAAe,KAAK;AACpB,iBAAiB,6CAAI;AACrB,eAAe,aAAa;AAC5B;AACA,eAAe,SAAS;AACxB;AACA,eAAe,SAAS;AACxB;AACA,eAAe,iBAAiB;AAChC;AACA,eAAe,cAAc;AAC7B;AACA,eAAe,SAAS;AACxB;;AAEA;AACA,eAAe,OAAO;AACtB;AACA,eAAe,OAAO;AACtB;AACA,eAAe,QAAQ;AACvB;AACA,eAAe,OAAO;AACtB;AACA,eAAe,sBAAsB;AACrC;AACA,eAAe,OAAO;AACtB;AACA,eAAe,OAAO;AACtB;AACA,eAAe,OAAO;AACtB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,eAAe,KAAK;AACpB;;AAEA;AACA;;AAEA;AACA;AACA,aAAa,SAAS;AACtB,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,SAAS;AACtB,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,YAAY;AACjB;AACA;AACA;;AAEA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,UAAU;AACnD;;AAEA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,MAAM;AAC9D;;AAEA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,MAAM;AAC9D;;AAEA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,MAAM;AAC7D;;AAEA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA,wCAAwC,sBAAsB;AAC9D;;AAEA;AACA;AACA,aAAa,sBAAsB;AACnC;AACA;AACA;AACA,uCAAuC,KAAK;AAC5C;;AAEA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,KAAK;AACjD;;AAEA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,EAAE;AAC5C;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA,eAAe,OAAO;AACtB;AACA,eAAe,OAAO;AACtB;AACA,eAAe,YAAY;AAC3B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","file":"sf2.synth.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"SoundFont\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SoundFont\"] = factory();\n\telse\n\t\troot[\"SoundFont\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/wml.js\");\n","// This file is auto-generated by the build system.\nconst Meta = {\n  version: '0.2.1',\n  date: '2019-12-26T15:48:03.337Z',\n};\nexport default Meta;\n","import Meta from './meta';\n/**\n * JS reverb effect class\n *\n * @author    Logue <logue@hotmail.co.jp>\n * @copyright 2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license   MIT\n * @see       {@link https://github.com/logue/Reverb.js}\n *            {@link https://github.com/web-audio-components/simple-reverb}\n */\nexport default class Reverb {\n  /**\n   * constructor\n   * @param {AudioContext} ctx\n   * @param {{\n   *   decay: (number|undefined),\n   *   delay: (number|undefined),\n   *   filterFreq: (number|undefined),\n   *   filterQ: (number|undefined),\n   *   filterType: (string|undefined),\n   *   mix: (number|undefined),\n   *   reverse: (boolean|undefined),\n   *   time: (number|undefined)\n   * }} options\n   */\n  constructor(ctx, options = {}) {\n    /** @type {number}  */\n    this.version = Meta.version;\n    /** @type {Date}  */\n    this.build = Meta.date;\n    /** @type {AudioContext} */\n    this.ctx = ctx;\n    /** @type {GainNode}  */\n    this.wetGainNode = this.ctx.createGain();\n    /** @type {GainNode}  */\n    this.dryGainNode = this.ctx.createGain();\n    /** @type {BiquadFilterNode}  */\n    this.filterNode = this.ctx.createBiquadFilter();\n    /** @type {ConvolverNode}  */\n    this.convolverNode = this.ctx.createConvolver();\n    /** @type {GainNode}  */\n    this.outputNode = this.ctx.createGain();\n\n    // \n    /** @type {number}  */\n    this._decay = options.decay | 0 || 5;\n    /** @type {number}  */\n    this._delay = options.delay | 0 || 0;\n    /** @type {boolean}  */\n    this._reverse = options.reverse || false;\n    /** @type {number}  */\n    this._time = options.time | 0 || 3;\n    /** @type {BiquadFilterNode|null}  */\n    this._filterType = options.filterType || 'lowpass';\n    /** @type {number} (Hz) */\n    this._freq = options.filterFreq | 0 || 2200;\n    /** @type {number}  */\n    this._q = options.filterQ | 0 || 1;\n    /** @type {number}  */\n    this._mix = options.mix || 0.5;\n\n    // \n    this.time(this._time);\n    this.delay(this._delay);\n    this.decay(this._decay);\n    this.reverse(this._reverse);\n\n    // \n    this.filterType(this._filterType);\n    this.filterFreq(this._freq);\n    this.filterQ(this._q);\n\n    this.mix(this._mix);\n\n    /** @type {bool}  */\n    this.isConnected = false;\n\n    this.buildImpulse();\n  }\n\n  /**\n   * connect\n   * @param {GainNode} sourceNode\n   * @return {GainNode}\n   */\n  connect(sourceNode) {\n    this.isConnected = true;\n    // \n    this.convolverNode.connect(this.filterNode);\n    // \n    this.filterNode.connect(this.wetGainNode);\n    // \n    sourceNode.connect(this.convolverNode);\n    // \n    sourceNode.connect(this.dryGainNode).connect(this.outputNode);\n    // \n    sourceNode.connect(this.wetGainNode).connect(this.outputNode);\n    return this.outputNode;\n  }\n\n  /**\n   * disconnect\n   * @param {GainNode} sourceNode\n   * @return {GainNode}\n   */\n  disconnect(sourceNode) {\n    // \n    try {\n      // \n      this.convolverNode.disconnect(this.filterNode);\n      // \n      this.filterNode.disconnect(this.wetGainNode);\n      // \n      sourceNode.disconnect(this.convolverNode);\n      // \n      sourceNode.disconnect(this.dryGainNode).disconnect(this.outputNode);\n      // \n      sourceNode.disconnect(this.wetGainNode).disconnect(this.outputNode);\n    } catch (e) { }\n    this.isConnected = false;\n    return sourceNode;\n  }\n\n  /**\n   * Mixing Dry and Wet Level.\n   * @param {number} mix\n   */\n  mix(mix) {\n    if (!this.inRange(mix, 0, 1)) {\n      console.warn('Dry/Wet level must be between 0 to 1.');\n      return;\n    }\n    this._mix = mix;\n    this.dryGainNode.gain.value = (1 - this._mix);\n    this.wetGainNode.gain.value = this._mix;\n    console.info(`Set dry/wet level to ${mix * 100}%`);\n  }\n\n  /**\n   * Set Impulse Response time length (second)\n   * @param {number} value\n   */\n  time(value) {\n    if (!this.inRange(value, 1, 50)) {\n      console.warn('Time length of inpulse response must be less than 50sec.');\n      return;\n    }\n    this._time = value;\n    this.buildImpulse();\n    console.info(`Set inpulse response time length to ${value}sec.`);\n  }\n\n  /**\n   * Impulse response decay rate.\n   * @param {number} value\n   */\n  decay(value) {\n    if (!this.inRange(value, 0, 100)) {\n      console.warn('Inpulse Response decay level must be less than 100.');\n      return;\n    }\n    this._decay = value;\n    this.buildImpulse();\n    console.info(`Set inpulse response decay level to ${value}.`);\n  }\n\n  /**\n   * Impulse response delay time. (NOT deley effect)\n   * @param {number} value\n   */\n  delay(value) {\n    if (!this.inRange(value, 0, 100)) {\n      console.warn('Inpulse Response delay time must be less than 100.');\n      return;\n    }\n    this._delay = value;\n    this.buildImpulse();\n    console.info(`Set inpulse response delay time to ${value}sec.`);\n  }\n\n  /**\n   * Reverse the impulse response.\n   * @param {boolean} reverse\n   */\n  reverse(reverse) {\n    this._reverse = reverse;\n    this.buildImpulse();\n    console.info(`Inpulse response is ${reverse ? '' : 'not '}reversed.`);\n  }\n\n  /**\n   * Filter type.\n   * @param {BiquadFilterNode|null} type\n   */\n  filterType(type) {\n    this.filterNode.type = this._filterType = type;\n    console.info(`Set filter type to ${type}`);\n  }\n\n  /**\n   * Filter frequency.\n   * @param {number} freq\n   */\n  filterFreq(freq) {\n    if (!this.inRange(freq, 20, 5000)) {\n      console.warn('Filter frequrncy must be between 20 and 5000.');\n      return;\n    }\n    this._freq = freq;\n    this.filterNode.frequency.value = this._freq;\n    console.info(`Set filter frequency to ${freq}Hz.`);\n  }\n\n  /**\n   * Filter quality.\n   * @param {number} q\n   */\n  filterQ(q) {\n    if (!this.inRange(q, 0, 10)) {\n      console.warn('Filter quality value must be between 0 and 1.');\n      return;\n    }\n    this._q = q;\n    this.filterNode.Q.value = this._q;\n    console.info(`Set filter quality to ${q}.`);\n  }\n\n  /**\n   * return true if in range, otherwise false\n   * @private\n   * @param {number} x Target value\n   * @param {number} min Minimum value\n   * @param {number} max Maximum value\n   * @return {bool}\n   */\n  inRange(x, min, max) {\n    return ((x - min) * (x - max) <= 0);\n  }\n\n  /**\n   * Utility function for building an impulse response\n   * from the module parameters.\n   * @private\n   */\n  buildImpulse() {\n    // \n    /** @type {number}  */\n    const rate = this.ctx.sampleRate;\n    /** @type {number}  */\n    const length = Math.max(rate * this._time, 1);\n    /** @type {number}  */\n    const delayDuration = rate * this._delay;\n    /** @type {AudioBuffer}  */\n    const impulse = this.ctx.createBuffer(2, length, rate);\n    /** @type {Array<number>|ArrayBufferView}  */\n    const impulseL = new Float32Array(length);\n    /** @type {Array<number>|ArrayBufferView} */\n    const impulseR = new Float32Array(length);\n\n    for (let i = 0; i < length; i++) {\n      /** @type {number} */\n      let n = 0;\n\n      if (i < delayDuration) {\n        // Delay Effect\n        impulseL[i] = 0;\n        impulseR[i] = 0;\n        n = this._reverse ? length - (i - delayDuration) : i - delayDuration;\n      } else {\n        n = this._reverse ? length - i : i;\n      }\n\n      /** @type {number}  */\n      const pow = (1 - n / length) ** this._decay;\n      impulseL[i] = this.getNoise(pow);\n      impulseR[i] = this.getNoise(pow);\n    }\n\n    // WaveTable\n    impulse.getChannelData(0).set(impulseL);\n    impulse.getChannelData(1).set(impulseR);\n\n    this.convolverNode.buffer = impulse;\n  }\n  /**\n   * Generate white noise\n   * @param {number} rate Attenuation rate\n   * @return {number}\n   * @private\n   */\n  getNoise(rate) {\n    // TODO: \n    return (Math.random() * 2 - 1) * rate;\n  }\n};\n","// This file is auto-generated by the build system.\nconst Meta = {\n  version: '0.3.4',\n  date: '2020-01-02T16:21:34.166Z',\n};\nexport default Meta;\n","/**\n * Riff Parser class\n * @private\n */\nexport default class Riff {\n  /**\n   * @param {ByteArray} input input buffer.\n   * @param {Object=} optParams option parameters.\n   */\n  constructor(input, optParams = {}) {\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {number} */\n    this.ip = optParams.index || 0;\n    /** @type {number} */\n    this.length = optParams.length || input.length - this.ip;\n    /** @type {Array.<RiffChunk>} */\n    this.chunkList;\n    /** @type {number} */\n    this.offset = this.ip;\n    /** @type {boolean} */\n    this.padding =\n      optParams.padding !== void 0 ? optParams.padding : true;\n    /** @type {boolean} */\n    this.bigEndian =\n      optParams.bigEndian !== void 0 ? optParams.bigEndian : false;\n  }\n\n  /**\n   */\n  parse() {\n    /** @type {number} */\n    const length = this.length + this.offset;\n\n    this.chunkList = [];\n\n    while (this.ip < length) {\n      this.parseChunk();\n    }\n  }\n\n  /**\n   */\n  parseChunk() {\n    /** @type {ByteArray} */\n    const input = this.input;\n    /** @type {number} */\n    let ip = this.ip;\n    /** @type {number} */\n    let size;\n\n    this.chunkList.push(new RiffChunk(\n      String.fromCharCode(input[ip++], input[ip++], input[ip++], input[ip++]),\n      (size = this.bigEndian ?\n        ((input[ip++] << 24) | (input[ip++] << 16) |\n          (input[ip++] << 8) | (input[ip++])) >>> 0 :\n        ((input[ip++]) | (input[ip++] << 8) |\n          (input[ip++] << 16) | (input[ip++] << 24)) >>> 0\n      ),\n      ip,\n    ));\n\n    ip += size;\n\n    // padding\n    if (this.padding && ((ip - this.offset) & 1) === 1) {\n      ip++;\n    }\n\n    this.ip = ip;\n  }\n\n  /**\n   * @param {number} index chunk index.\n   * @return {?RiffChunk}\n   */\n  getChunk(index) {\n    /** @type {RiffChunk} */\n    const chunk = this.chunkList[index];\n\n    if (chunk === void 0) {\n      return null;\n    }\n\n    return chunk;\n  }\n\n  /**\n   * @return {number}\n   */\n  getNumberOfChunks() {\n    return this.chunkList.length;\n  }\n}\n\n/**\n * Riff Chunk Structure\n * @interface\n */\nclass RiffChunk {\n  /**\n   * @param {string} type\n   * @param {number} size\n   * @param {number} offset\n   */\n  constructor(type, size, offset) {\n    /** @type {string} */\n    this.type = type;\n    /** @type {number} */\n    this.size = size;\n    /** @type {number} */\n    this.offset = offset;\n  }\n}\n","import Riff from './riff.js';\n\n/**\n * SoundFont Parser Class\n */\nexport class Parser {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {(Object|undefined)} */\n    this.parserOption = optParams.parserOption || {};\n    /** @type {(Number|undefined)} */\n    this.sampleRate = optParams.sampleRate || 22050; // OS\n\n    /** @type {Array.<Object>} */\n    this.presetHeader;\n    /** @type {Array.<Object>} */\n    this.presetZone;\n    /** @type {Array.<Object>} */\n    this.presetZoneModulator;\n    /** @type {Array.<Object>} */\n    this.presetZoneGenerator;\n    /** @type {Array.<Object>} */\n    this.instrument;\n    /** @type {Array.<Object>} */\n    this.instrumentZone;\n    /** @type {Array.<Object>} */\n    this.instrumentZoneModulator;\n    /** @type {Array.<Object>} */\n    this.instrumentZoneGenerator;\n    /** @type {Array.<Object>} */\n    this.sampleHeader;\n\n    /**\n     * @type {Array.<string>}\n     * @const\n     */\n    this.GeneratorEnumeratorTable = [\n      'startAddrsOffset',\n      'endAddrsOffset',\n      'startloopAddrsOffset',\n      'endloopAddrsOffset',\n      'startAddrsCoarseOffset',\n      'modLfoToPitch',\n      'vibLfoToPitch',\n      'modEnvToPitch',\n      'initialFilterFc',\n      'initialFilterQ',\n      'modLfoToFilterFc',\n      'modEnvToFilterFc',\n      'endAddrsCoarseOffset',\n      'modLfoToVolume', , // 14\n      'chorusEffectsSend',\n      'reverbEffectsSend',\n      'pan', , , , // 18,19,20\n      'delayModLFO',\n      'freqModLFO',\n      'delayVibLFO',\n      'freqVibLFO',\n      'delayModEnv',\n      'attackModEnv',\n      'holdModEnv',\n      'decayModEnv',\n      'sustainModEnv',\n      'releaseModEnv',\n      'keynumToModEnvHold',\n      'keynumToModEnvDecay',\n      'delayVolEnv',\n      'attackVolEnv',\n      'holdVolEnv',\n      'decayVolEnv',\n      'sustainVolEnv',\n      'releaseVolEnv',\n      'keynumToVolEnvHold',\n      'keynumToVolEnvDecay',\n      'instrument', , // 42\n      'keyRange',\n      'velRange',\n      'startloopAddrsCoarseOffset',\n      'keynum',\n      'velocity',\n      'initialAttenuation', , // 49\n      'endloopAddrsCoarseOffset',\n      'coarseTune',\n      'fineTune',\n      'sampleID',\n      'sampleModes', , // 55\n      'scaleTuning',\n      'exclusiveClass',\n      'overridingRootKey', // 59\n      'endOper',\n    ];\n  }\n\n  /** @export */\n  parse() {\n    /** @type {Riff} */\n    const parser = new Riff(this.input, this.parserOption);\n\n    // parse RIFF chunk\n    parser.parse();\n    if (parser.chunkList.length !== 1) {\n      throw new Error('wrong chunk length');\n    }\n\n    /** @type {?RiffChunk} */\n    const chunk = parser.getChunk(0);\n    if (chunk === null) {\n      throw new Error('chunk not found');\n    }\n\n    this.parseRiffChunk(chunk);\n    // console.log(this.sampleHeader);\n    this.input = null;\n  }\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseRiffChunk(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'RIFF') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'sfbk') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n    if (parser.getNumberOfChunks() !== 3) {\n      throw new Error('invalid sfbk structure');\n    }\n\n    // INFO-list\n    this.parseInfoList( /** @type {!RiffChunk} */(parser.getChunk(0)));\n\n    // sdta-list\n    this.parseSdtaList( /** @type {!RiffChunk} */(parser.getChunk(1)));\n\n    // pdta-list\n    this.parsePdtaList( /** @type {!RiffChunk} */(parser.getChunk(2)));\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseInfoList(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'LIST') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'INFO') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseSdtaList(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'LIST') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'sdta') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n    if (parser.chunkList.length !== 1) {\n      throw new Error('TODO');\n    }\n    this.samplingData =\n      /** @type {{type: string, size: number, offset: number}} */\n      (parser.getChunk(0));\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePdtaList(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'LIST') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'pdta') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n\n    // check number of chunks\n    if (parser.getNumberOfChunks() !== 9) {\n      throw new Error('invalid pdta chunk');\n    }\n\n    this.parsePhdr( /** @type {RiffChunk} */(parser.getChunk(0)));\n    this.parsePbag( /** @type {RiffChunk} */(parser.getChunk(1)));\n    this.parsePmod( /** @type {RiffChunk} */(parser.getChunk(2)));\n    this.parsePgen( /** @type {RiffChunk} */(parser.getChunk(3)));\n    this.parseInst( /** @type {RiffChunk} */(parser.getChunk(4)));\n    this.parseIbag( /** @type {RiffChunk} */(parser.getChunk(5)));\n    this.parseImod( /** @type {RiffChunk} */(parser.getChunk(6)));\n    this.parseIgen( /** @type {RiffChunk} */(parser.getChunk(7)));\n    this.parseShdr( /** @type {RiffChunk} */(parser.getChunk(8)));\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePhdr(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const presetHeader = this.presetHeader = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'phdr') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      presetHeader.push({\n        presetName: String.fromCharCode.apply(null, data.subarray(ip, ip += 20)),\n        preset: data[ip++] | (data[ip++] << 8),\n        bank: data[ip++] | (data[ip++] << 8),\n        presetBagIndex: data[ip++] | (data[ip++] << 8),\n        library: (data[ip++] | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)) >>> 0,\n        genre: (data[ip++] | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)) >>> 0,\n        morphology: (data[ip++] | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)) >>> 0,\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePbag(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const presetZone = this.presetZone = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'pbag') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      presetZone.push({\n        presetGeneratorIndex: data[ip++] | (data[ip++] << 8),\n        presetModulatorIndex: data[ip++] | (data[ip++] << 8),\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePmod(chunk) {\n    // check parse target\n    if (chunk.type !== 'pmod') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    this.presetZoneModulator = this.parseModulator(chunk);\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePgen(chunk) {\n    // check parse target\n    if (chunk.type !== 'pgen') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n    this.presetZoneGenerator = this.parseGenerator(chunk);\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseInst(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const instrument = this.instrument = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'inst') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      instrument.push({\n        instrumentName: String.fromCharCode.apply(null, data.subarray(ip, ip += 20)),\n        instrumentBagIndex: data[ip++] | (data[ip++] << 8),\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseIbag(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const instrumentZone = this.instrumentZone = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'ibag') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n\n    while (ip < size) {\n      instrumentZone.push({\n        instrumentGeneratorIndex: data[ip++] | (data[ip++] << 8),\n        instrumentModulatorIndex: data[ip++] | (data[ip++] << 8),\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseImod(chunk) {\n    // check parse target\n    if (chunk.type !== 'imod') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    this.instrumentZoneModulator = this.parseModulator(chunk);\n  };\n\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseIgen(chunk) {\n    // check parse target\n    if (chunk.type !== 'igen') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    this.instrumentZoneGenerator = this.parseGenerator(chunk);\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseShdr(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const samples = this.sample = [];\n    /** @type {Array.<Object>} */\n    const sampleHeader = this.sampleHeader = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n    /** @type {string} */\n    let sampleName;\n    /** @type {number} */\n    let start;\n    /** @type {number} */\n    let end;\n    /** @type {number} */\n    let startLoop;\n    /** @type {number} */\n    let endLoop;\n    /** @type {number} */\n    let sampleRate;\n    /** @type {number} */\n    let originalPitch;\n    /** @type {number} */\n    let pitchCorrection;\n    /** @type {number} */\n    let sampleLink;\n    /** @type {number} */\n    let sampleType;\n\n    // check parse target\n    if (chunk.type !== 'shdr') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      sampleName = String.fromCharCode.apply(null, data.subarray(ip, ip += 20));\n      start = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      end = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      startLoop = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      endLoop = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      sampleRate = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      originalPitch = data[ip++];\n      pitchCorrection = (data[ip++] << 24) >> 24;\n      sampleLink = data[ip++] | (data[ip++] << 8);\n      sampleType = data[ip++] | (data[ip++] << 8);\n\n      let sample = new Int16Array(new Uint8Array(data.subarray(\n        this.samplingData.offset + start * 2,\n        this.samplingData.offset + end * 2,\n      )).buffer);\n\n      startLoop -= start;\n      endLoop -= start;\n\n      if (sampleRate > 0) {\n        const adjust = this.adjustSampleData(sample, sampleRate);\n        sample = adjust.sample;\n        sampleRate *= adjust.multiply;\n        startLoop *= adjust.multiply;\n        endLoop *= adjust.multiply;\n      }\n\n      samples.push(sample);\n\n      sampleHeader.push({\n        sampleName: sampleName,\n        start: start,\n        end: end,\n        startLoop: startLoop,\n        endLoop: endLoop,\n        sampleRate: sampleRate,\n        originalPitch: originalPitch,\n        pitchCorrection: pitchCorrection,\n        sampleLink: sampleLink,\n        sampleType: sampleType,\n      });\n    }\n  };\n\n  /**\n   * @param {Array} sample\n   * @param {number} sampleRate\n   * @return {object}\n   */\n  adjustSampleData(sample, sampleRate) {\n    /** @type {Int16Array} */\n    let newSample;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let multiply = 1;\n\n    // buffer\n    while (sampleRate < (this.sampleRate)) { // AudioContext\n      newSample = new Int16Array(sample.length * 2);\n      for (i = j = 0, il = sample.length; i < il; ++i) {\n        newSample[j++] = sample[i];\n        newSample[j++] = sample[i];\n      }\n      sample = newSample;\n      multiply *= 2;\n      sampleRate *= 2;\n    }\n\n    return {\n      sample: sample,\n      multiply: multiply,\n    };\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   * @return {Array.<Object>}\n   */\n  parseModulator(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n    /** @type {number} */\n    let code;\n    /** @type {string} */\n    let key;\n    /** @type {Array.<Object>} */\n    const output = [];\n\n    while (ip < size) {\n      // Src  Oper\n      // TODO\n      ip += 2;\n\n      // Dest Oper\n      code = data[ip++] | (data[ip++] << 8);\n      key = this.GeneratorEnumeratorTable[code];\n      if (key === void 0) {\n        // Amount\n        output.push({\n          type: key,\n          value: {\n            code: code,\n            amount: data[ip] | (data[ip + 1] << 8) << 16 >> 16,\n            lo: data[ip++],\n            hi: data[ip++],\n          },\n        });\n      } else {\n        // Amount\n        switch (key) {\n          case 'keyRange':\n          /* FALLTHROUGH */\n          case 'velRange':\n          /* FALLTHROUGH */\n          case 'keynum':\n          /* FALLTHROUGH */\n          case 'velocity':\n            output.push({\n              type: key,\n              value: {\n                lo: data[ip++],\n                hi: data[ip++],\n              },\n            });\n            break;\n          default:\n            output.push({\n              type: key,\n              value: {\n                amount: data[ip++] | (data[ip++] << 8) << 16 >> 16,\n              },\n            });\n            break;\n        }\n      }\n\n      // AmtSrcOper\n      // TODO\n      ip += 2;\n\n      // Trans Oper\n      // TODO\n      ip += 2;\n    }\n\n    return output;\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   * @return {Array.<Object>}\n   */\n  parseGenerator(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n    /** @type {number} */\n    let code;\n    /** @type {string} */\n    let key;\n    /** @type {Array.<Object>} */\n    const output = [];\n\n    while (ip < size) {\n      code = data[ip++] | (data[ip++] << 8);\n      key = this.GeneratorEnumeratorTable[code];\n      if (key === void 0) {\n        output.push({\n          type: key,\n          value: {\n            code: code,\n            amount: data[ip] | (data[ip + 1] << 8) << 16 >> 16,\n            lo: data[ip++],\n            hi: data[ip++],\n          },\n        });\n        continue;\n      }\n\n      switch (key) {\n        case 'keynum':\n        /* FALLTHROUGH */\n        case 'keyRange':\n        /* FALLTHROUGH */\n        case 'velRange':\n        /* FALLTHROUGH */\n        case 'velocity':\n          output.push({\n            type: key,\n            value: {\n              lo: data[ip++],\n              hi: data[ip++],\n            },\n          });\n          break;\n        default:\n          output.push({\n            type: key,\n            value: {\n              amount: data[ip++] | (data[ip++] << 8) << 16 >> 16,\n            },\n          });\n          break;\n      }\n    }\n\n    return output;\n  };\n\n  /**\n   * @return {Array.<object>}\n   */\n  createInstrument() {\n    /** @type {Array.<Object>} */\n    const instrument = this.instrument;\n    /** @type {Array.<Object>} */\n    const zone = this.instrumentZone;\n    /** @type {Array.<Object>} */\n    const output = [];\n    /** @type {number} */\n    let bagIndex;\n    /** @type {number} */\n    let bagIndexEnd;\n    /** @type {Array.<Object>} */\n    let zoneInfo;\n    /** @type {{generator: Object, generatorInfo: Array.<Object>}} */\n    let instrumentGenerator;\n    /** @type {{modulator: Object, modulatorInfo: Array.<Object>}} */\n    let instrumentModulator;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n\n    // instrument -> instrument bag -> generator / modulator\n    for (i = 0, il = instrument.length; i < il; ++i) {\n      bagIndex = instrument[i].instrumentBagIndex;\n      bagIndexEnd = instrument[i + 1] ? instrument[i + 1].instrumentBagIndex : zone.length;\n      zoneInfo = [];\n\n      // instrument bag\n      for (j = bagIndex, jl = bagIndexEnd; j < jl; ++j) {\n        instrumentGenerator = this.createInstrumentGenerator_(zone, j);\n        instrumentModulator = this.createInstrumentModulator_(zone, j);\n\n        zoneInfo.push({\n          generator: instrumentGenerator.generator,\n          generatorSequence: instrumentGenerator.generatorInfo,\n          modulator: instrumentModulator.modulator,\n          modulatorSequence: instrumentModulator.modulatorInfo,\n        });\n      }\n\n      output.push({\n        name: instrument[i].instrumentName,\n        info: zoneInfo,\n      });\n    }\n\n    return output;\n  };\n\n  /**\n   * @return {Array.<object>}\n   */\n  createPreset() {\n    /** @type {Array.<Object>} */\n    const preset = this.presetHeader;\n    /** @type {Array.<Object>} */\n    const zone = this.presetZone;\n    /** @type {Array.<Object>} */\n    const output = [];\n    /** @type {number} */\n    let bagIndex;\n    /** @type {number} */\n    let bagIndexEnd;\n    /** @type {Array.<Object>} */\n    let zoneInfo;\n    /** @type {number} */\n    let instrument;\n    /** @type {{generator: Object, generatorInfo: Array.<Object>}} */\n    let presetGenerator;\n    /** @type {{modulator: Object, modulatorInfo: Array.<Object>}} */\n    let presetModulator;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n\n    // preset -> preset bag -> generator / modulator\n    for (i = 0, il = preset.length; i < il; ++i) {\n      bagIndex = preset[i].presetBagIndex;\n      bagIndexEnd = preset[i + 1] ? preset[i + 1].presetBagIndex : zone.length;\n      zoneInfo = [];\n\n      // preset bag\n      for (j = bagIndex, jl = bagIndexEnd; j < jl; ++j) {\n        presetGenerator = this.createPresetGenerator_(zone, j);\n        presetModulator = this.createPresetModulator_(zone, j);\n\n        zoneInfo.push({\n          generator: presetGenerator.generator,\n          generatorSequence: presetGenerator.generatorInfo,\n          modulator: presetModulator.modulator,\n          modulatorSequence: presetModulator.modulatorInfo,\n        });\n\n        instrument =\n          presetGenerator.generator['instrument'] !== void 0 ?\n            presetGenerator.generator['instrument'].amount :\n            presetModulator.modulator['instrument'] !== void 0 ?\n              presetModulator.modulator['instrument'].amount :\n              null;\n      }\n\n      output.push({\n        name: preset[i].presetName,\n        info: zoneInfo,\n        header: preset[i],\n        instrument: instrument,\n      });\n    }\n\n    return output;\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{generator: Object, generatorInfo: Array.<Object>}}\n   * @private\n   */\n  createInstrumentGenerator_(zone, index) {\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].instrumentGeneratorIndex,\n      zone[index + 1] ? zone[index + 1].instrumentGeneratorIndex : this.instrumentZoneGenerator.length,\n      this.instrumentZoneGenerator,\n    );\n\n    return {\n      generator: modgen.modgen,\n      generatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{modulator: Object, modulatorInfo: Array.<Object>}}\n   * @private\n   */\n  createInstrumentModulator_(zone, index) {\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].presetModulatorIndex,\n      zone[index + 1] ? zone[index + 1].instrumentModulatorIndex : this.instrumentZoneModulator.length,\n      this.instrumentZoneModulator,\n    );\n\n    return {\n      modulator: modgen.modgen,\n      modulatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{generator: Object, generatorInfo: Array.<Object>}}\n   * @private\n   */\n  createPresetGenerator_(zone, index) {\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].presetGeneratorIndex,\n      zone[index + 1] ? zone[index + 1].presetGeneratorIndex : this.presetZoneGenerator.length,\n      this.presetZoneGenerator,\n    );\n\n    return {\n      generator: modgen.modgen,\n      generatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{modulator: Object, modulatorInfo: Array.<Object>}}\n   * @private\n   */\n  createPresetModulator_(zone, index) {\n    /** @type {{modgen: Object, modgenInfo: Array.<Object>}} */\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].presetModulatorIndex,\n      zone[index + 1] ? zone[index + 1].presetModulatorIndex : this.presetZoneModulator.length,\n      this.presetZoneModulator,\n    );\n\n    return {\n      modulator: modgen.modgen,\n      modulatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} indexStart\n   * @param {number} indexEnd\n   * @param {Array} zoneModGen\n   * @return {{modgen: Object, modgenInfo: Array.<Object>}}\n   * @private\n   */\n  createBagModGen_(zone, indexStart, indexEnd, zoneModGen) {\n    /** @type {Array.<Object>} */\n    const modgenInfo = [];\n    /** @type {Object} */\n    const modgen = {\n      'unknown': [],\n      'keyRange': {\n        hi: 127,\n        lo: 0,\n      },\n    }; // TODO\n    /** @type {Object} */\n    let info;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    for (i = indexStart, il = indexEnd; i < il; ++i) {\n      info = zoneModGen[i];\n      modgenInfo.push(info);\n\n      if (info.type === 'unknown') {\n        modgen.unknown.push(info.value);\n      } else {\n        modgen[info.type] = info.value;\n      }\n    }\n\n    return {\n      modgen: modgen,\n      modgenInfo: modgenInfo,\n    };\n  }\n}\n\nexport default Parser;\n","import SynthesizerNote from './sound_font_synth_note';\nimport Parser from './sf2';\nimport Reverb from '@logue/reverb/src/reverb';\n/**\n * Synthesizer Class\n * @private\n */\nexport class Synthesizer {\n  /**\n   * @param {Uint8Array} input\n   */\n  constructor(input) {\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    /** @type {Uint8Array} */\n    this.input = input;\n    /** @type {SoundFont.Parser} */\n    this.parser = {};\n    /** @type {number} */\n    this.bank = 0;\n    /** @type {Array.<Array.<Object>>} */\n    this.bankSet = {};\n    /** @type {number} */\n    this.bufferSize = 2048;\n    /** @type {AudioContext} */\n    this.ctx = this.getAudioContext();\n    /** @type {GainNode} */\n    this.gainMaster = this.ctx.createGain();\n    /** @type {AudioBufferSourceNode} */\n    this.bufSrc = this.ctx.createBufferSource();\n    /** @type {Array.<number>} */\n    this.channelInstrument = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.channelBank = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 127, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.channelVolume = [127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127];\n    /** @type {Array.<number>} */\n    this.channelPanpot = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelPitchBend = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.channelPitchBendSensitivity = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2];\n    /** @type {Array.<number>} */\n    this.channelExpression = [127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127];\n    /** @type {Array.<number>} */\n    this.channelAttack = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelDecay = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelSustin = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelRelease = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n\n    /** @type {Array.<boolean>} */\n    this.channelHold = [\n      false, false, false, false, false, false, false, false,\n      false, false, false, false, false, false, false, false,\n    ];\n    /** @type {Array.<number>} */\n    this.channelHarmonicContent = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelCutOffFrequency = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n\n    /** @type {boolean} */\n    this.isGS = false;\n    /** @type {boolean} */\n    this.isXG = false;\n\n    /** @type {Array.<Array.<string>>} */\n    this.programSet = [];\n\n    /** @type {Array.<boolean>} */\n    this.channelMute = [\n      false, false, false, false, false, false, false, false,\n      false, false, false, false, false, false, false, false,\n    ];\n    /** @type {Array.<Array.<SoundFont.SynthesizerNote>>} */\n    this.currentNoteOn = [\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n    ];\n    /** @type {number} @const */\n    this.baseVolume = 1 / 0xffff;\n    /** @type {number} */\n    this.masterVolume = 16384;\n\n    /** @type {Array.<boolean>} */\n    this.percussionPart = [\n      false, false, false, false, false, false, false, false,\n      false, true, false, false, false, false, false, false,\n    ];\n\n    /** @type {Array.<number>} */\n    this.percussionVolume = new Array(128);\n    for (i = 0, il = this.percussionVolume.length; i < il; ++i) {\n      this.percussionVolume[i] = 127;\n    }\n\n    this.programSet = {};\n\n    /** @type {Array.<Reverb>} */\n    this.reverb = [];\n\n    /** @type {Array.<BiquadFilterNode>}  */\n    this.filter = [];\n\n    for (i = 0; i < 16; ++i) {\n      this.reverb[i] = new Reverb(this.ctx, { mix: 0.315 });// 4040/127\n      // \n      this.filter[i] = this.ctx.createBiquadFilter();\n    }\n\n    this.observer = new IntersectionObserver((entries, object) => {\n      entries.forEach((entry, i) => {\n        // \n        entry.target.dataset.isIntersecting = entry.isIntersecting;\n      });\n    }, {});\n  }\n\n  /**\n   * @return {AudioContext}\n   */\n  getAudioContext() {\n    /** @type {AudioContext} */\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n\n    // for legacy browsers\n    ctx.createGain = ctx.createGain || ctx.createGainNode;\n\n    // Defreeze AudioContext for iOS.\n    const initAudioContext = () => {\n      document.removeEventListener('touchstart', initAudioContext);\n      // wake up AudioContext\n      const emptySource = ctx.createBufferSource();\n      emptySource.start();\n      emptySource.stop();\n    };\n\n    document.addEventListener('touchstart', initAudioContext);\n\n    return ctx;\n  }\n\n  /**\n   * System Reset\n   * @param {string} mode\n   */\n  init(mode = 'GM') {\n    this.gainMaster.disconnect();\n\n    /** @type {number} */\n    let i;\n\n    this.parser = new Parser(this.input, {\n      sampleRate: this.ctx.sampleRate,\n    });\n    this.bankSet = this.createAllInstruments();\n\n    this.isXG = false;\n    this.isGS = false;\n\n    if (mode == 'XG') {\n      this.isXG = true;\n    } else if (mode == 'GS') {\n      this.isGS = true;\n    }\n\n    for (i = 0; i < 16; ++i) {\n      this.programChange(i, 0x00);\n      this.volumeChange(i, 0x64);\n      this.panpotChange(i, 0x40);\n      this.pitchBend(i, 0x00, 0x40); // 8192\n      this.pitchBendSensitivity(i, 2);\n      this.channelHold[i] = false;\n      this.channelExpression[i] = 127;\n      this.channelBank[i] = i === 9 ? 127 : 0;\n      this.attackTime(i, 64);\n      this.decayTime(i, 64);\n      this.sustinTime(i, 64);\n      this.releaseTime(i, 64);\n      this.harmonicContent(i, 64);\n      this.cutOffFrequency(i, 64);\n      this.reverbDepth(i, 40);\n      this.updateBankSelect(i);\n      this.updateProgramSelect(i);\n    }\n\n    this.setPercussionPart(9, true);\n\n    for (i = 0; i < 128; ++i) {\n      this.percussionVolume[i] = 127;\n    }\n\n    this.gainMaster.connect(this.ctx.destination);\n\n    /*\n    if (this.element) {\n      this.element.querySelector('.header div:before').innerText = mode + ' Mode';\n    }\n    */\n\n    this.element.dataset.mode = mode;\n  }\n\n  /**\n   */\n  close() {\n    this.ctx.close();\n  }\n\n  /**\n   * @param {Uint8Array} input\n   */\n  refreshInstruments(input) {\n    this.input = input;\n    this.parser = new Parser(input);\n    this.bankSet = this.createAllInstruments();\n  }\n\n  /** @return {Array.<Array.<Object>>} */\n  createAllInstruments() {\n    /** @type {SoundFont.Parser} */\n    const parser = this.parser;\n    parser.parse();\n    /** @type {Array} TODO */\n    const presets = parser.createPreset();\n    /** @type {Array} TODO */\n    const instruments = parser.createInstrument();\n    /** @type {Array} */\n    const banks = [];\n    /** @type {Array.<Array.<Object>>} */\n    let bank;\n    /** @type {number} */\n    let bankNumber;\n    /** @type {Object} TODO */\n    let preset;\n    /** @type {Object} */\n    let instrument;\n    /** @type {number} */\n    let presetNumber;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n    /** @type {string} */\n    let presetName;\n\n    const programSet = [];\n\n    for (i = 0, il = presets.length; i < il; ++i) {\n      preset = presets[i];\n      presetNumber = preset.header.preset;\n      bankNumber = preset.header.bank;\n      presetName = preset.name.replace(/\\0*$/, '');\n\n      if (typeof preset.instrument !== 'number') {\n        continue;\n      }\n\n      instrument = instruments[preset.instrument];\n      if (instrument.name.replace(/\\0*$/, '') === 'EOI') {\n        continue;\n      }\n\n      // select bank\n      if (banks[bankNumber] === void 0) {\n        banks[bankNumber] = [];\n      }\n      bank = banks[bankNumber];\n      bank[presetNumber] = {};\n      bank[presetNumber].name = presetName;\n\n      for (j = 0, jl = instrument.info.length; j < jl; ++j) {\n        this.createNoteInfo(parser, instrument.info[j], bank[presetNumber]);\n      }\n      if (!programSet[bankNumber]) {\n        programSet[bankNumber] = {};\n      }\n      programSet[bankNumber][presetNumber] = presetName;\n    }\n\n    this.programSet = programSet;\n\n    return banks;\n  }\n\n  /**\n   * @param {Parser} parser\n   * @param {*} info\n   * @param {*} preset\n   */\n  createNoteInfo(parser, info, preset) {\n    /** @type {Generator} */\n    const generator = info.generator;\n\n    if (generator.keyRange === void 0 || generator.sampleID === void 0) {\n      return;\n    }\n    // console.log(generator);\n    /** @type {number} */\n    const volDelay = this.getModGenAmount(generator, 'delayVolEnv', -12000);\n    /** @type {number} */\n    const volAttack = this.getModGenAmount(generator, 'attackVolEnv', -12000);\n    /** @type {number} */\n    const volHold = this.getModGenAmount(generator, 'holdVolEnv', -12000);\n    /** @type {number} */\n    const volDecay = this.getModGenAmount(generator, 'decayVolEnv', -12000);\n    /** @type {number} */\n    const volSustain = this.getModGenAmount(generator, 'sustainVolEnv');\n    /** @type {number} */\n    const volRelease = this.getModGenAmount(generator, 'releaseVolEnv', -12000);\n    /** @type {number} */\n    const modDelay = this.getModGenAmount(generator, 'delayModEnv', -12000);\n    /** @type {number} */\n    const modAttack = this.getModGenAmount(generator, 'attackModEnv', -12000);\n    /** @type {number} */\n    const modHold = this.getModGenAmount(generator, 'holdModEnv', -12000);\n    /** @type {number} */\n    const modDecay = this.getModGenAmount(generator, 'decayModEnv', -12000);\n    /** @type {number} */\n    const modSustain = this.getModGenAmount(generator, 'sustainModEnv');\n    /** @type {number} */\n    const modRelease = this.getModGenAmount(generator, 'releaseModEnv', -12000);\n    /** @type {number} */\n    const scale = this.getModGenAmount(generator, 'scaleTuning', 100) / 100;\n    /** @type {number} */\n    const freqVibLFO = this.getModGenAmount(generator, 'freqVibLFO');\n    /** @type {number} */\n    const pan = this.getModGenAmount(generator, 'pan');\n    /** @type {number} */\n    const tune = this.getModGenAmount(generator, 'coarseTune') + this.getModGenAmount(generator, 'fineTune') / 100;\n\n    for (let i = generator.keyRange.lo, il = generator.keyRange.hi; i <= il; ++i) {\n      if (preset[i]) {\n        continue;\n      }\n      /** @type {number} */\n      const sampleId = this.getModGenAmount(generator, 'sampleID');\n      /** @type {object} */\n      const sampleHeader = parser.sampleHeader[sampleId];\n      preset[i] = {\n        'sample': parser.sample[sampleId],\n        'sampleRate': sampleHeader.sampleRate,\n        'sampleModes': this.getModGenAmount(generator, 'sampleModes'),\n        'basePlaybackRate':\n          1.0594630943592953 // Math.pow(2, 1 / 12)\n          ** ((\n            i -\n            this.getModGenAmount(generator, 'overridingRootKey', sampleHeader.originalPitch) +\n            tune + (sampleHeader.pitchCorrection / 100)\n          ) * scale\n          ),\n        'modEnvToPitch': this.getModGenAmount(generator, 'modEnvToPitch') / 100,\n        'scaleTuning': scale,\n        'start': this.getModGenAmount(generator, 'startAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'startAddrsOffset'),\n        'end': this.getModGenAmount(generator, 'endAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'endAddrsOffset'),\n        'loopStart': (\n          // (sampleHeader.startLoop - sampleHeader.start) +\n          (sampleHeader.startLoop) +\n          this.getModGenAmount(generator, 'startloopAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'startloopAddrsOffset')\n        ),\n        'loopEnd': (\n          // (sampleHeader.endLoop - sampleHeader.start) +\n          (sampleHeader.endLoop) +\n          this.getModGenAmount(generator, 'endloopAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'endloopAddrsOffset')\n        ),\n        'volDelay': 2 ** (volDelay / 1200),\n        'volAttack': 2 ** (volAttack / 1200),\n        'volHold': 2 ** (volHold / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToVolEnvHold') / 1200),\n        'volDecay': 2 ** (volDecay / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToVolEnvDecay') / 1200),\n        'volSustain': volSustain / 1000,\n        'volRelease': 2 ** (volRelease / 1200),\n        'modDelay': 2 ** (modDelay / 1200),\n        'modAttack': 2 ** (modAttack / 1200),\n        'modHold': 2 ** (modHold / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToModEnvHold') / 1200),\n        'modDecay': 2 ** (modDecay / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToModEnvDecay') / 1200),\n        'modSustain': modSustain / 1000,\n        'modRelease': 2 ** (modRelease / 1200),\n        'initialFilterFc': this.getModGenAmount(generator, 'initialFilterFc', 13500),\n        'modEnvToFilterFc': this.getModGenAmount(generator, 'modEnvToFilterFc'),\n        'initialFilterQ': this.getModGenAmount(generator, 'initialFilterQ'),\n        'reverbEffectSend': this.getModGenAmount(generator, 'reverbEffectSend'),\n        'initialAttenuation': this.getModGenAmount(generator, 'initialAttenuation'),\n        'freqVibLFO': freqVibLFO ? (2 ** (freqVibLFO / 1200)) * 8.176 : void 0,\n        'pan': pan ? pan / 1200 : void 0,\n      };\n    }\n  };\n\n  /**\n   * @param {Object} generator\n   * @param {string} enumeratorType\n   * @param {number=} optDefault\n   * @return {number}\n   */\n  getModGenAmount(generator, enumeratorType, optDefault = null) {\n    return generator[enumeratorType] ? generator[enumeratorType].amount : optDefault;\n  }\n\n  /**\n   */\n  start() {\n    this.connect();\n    this.bufSrc.start(0);\n    this.setMasterVolume(16383);\n  }\n\n  /**\n   * @param {number} volume\n   */\n  setMasterVolume(volume) {\n    this.masterVolume = volume;\n    this.gainMaster.gain.value = this.baseVolume * (volume / 16384);\n  }\n\n  /**\n   */\n  connect() {\n    this.bufSrc.connect(this.gainMaster);\n  }\n\n  /**\n   */\n  disconnect() {\n    this.bufSrc.disconnect(this.gainMaster);\n    this.bufSrc.buffer = null;\n  }\n\n  /**\n   * @return {HTMLDivElement}\n   */\n  drawSynth() {\n    /** @type {Document} */\n    const doc = window.document;\n    /** @type {HTMLDivElement} */\n    const wrapper = this.element = doc.createElement('div');\n    wrapper.className = 'synthesizer';\n    /** @type {HTMLDivElement} */\n    const instElem = doc.createElement('div');\n    instElem.className = 'instrument';\n    /** @type {Array} */\n    const items = ['mute', 'bank', 'program', 'volume', 'panpot', 'pitchBend', 'pitchBendSensitivity', 'keys'];\n    /** @type {string} */\n    const eventStart = 'ontouchstart' in window ? 'touchstart' : 'mousedown';\n    /** @type {string} */\n    const eventEnd = 'ontouchend' in window ? 'touchend' : 'mouseup';\n\n    for (let channel = 0; channel < 16; channel++) {\n      /** @type {HTMLDivElement} */\n      const channelElem = doc.createElement('div');\n      channelElem.className = 'channel';\n      for (const item in items) {\n        if ({}.hasOwnProperty.call(items, item)) {\n          /** @type {HTMLDivElement} */\n          const itemElem = doc.createElement('div');\n          itemElem.className = items[item];\n\n          switch (items[item]) {\n            case 'mute':\n              /** @type {HTMLDivElement|null} */\n              const checkboxElement = doc.createElement('div');\n              checkboxElement.className = 'custom-control custom-checkbox custom-control-inline';\n              /** @type {HTMLInputElement|null} */\n              const checkbox = doc.createElement('input');\n              checkbox.setAttribute('type', 'checkbox');\n              checkbox.className = 'custom-control-input';\n              checkbox.id = 'mute' + channel + 'ch';\n              checkbox.addEventListener('change', ((synth, channelElem) => {\n                return () => {\n                  synth.mute(channelElem, this.checked);\n                };\n              })(this, channel), false);\n              checkboxElement.appendChild(checkbox);\n              /** @type {HTMLLabelElement} */\n              const labelElem = doc.createElement('label');\n              labelElem.className = 'custom-control-label';\n              labelElem.textContent = channel + 1;\n              labelElem.setAttribute('for', 'mute' + channel + 'ch');\n              checkboxElement.appendChild(labelElem);\n              itemElem.appendChild(checkboxElement);\n              break;\n            case 'bank':\n              // Bank select\n              /** @type {HTMLSelectElement} */\n              const bankSelect = doc.createElement('select');\n              bankSelect.className = 'form-control form-control-sm';\n              itemElem.appendChild(bankSelect);\n              /** @type {HTMLOptionElement} */\n              const option = doc.createElement('option');\n              bankSelect.appendChild(option);\n\n              bankSelect.addEventListener('change', ((synth, channelElem) => {\n                return (event) => {\n                  synth.bankChange(channelElem, event.target.value);\n                  synth.programChange(channelElem, synth.channelElemInstrument[channelElem]);\n                };\n              })(this, channel), false);\n\n              bankSelect.selectedIndex = this.channelBank[item];\n              break;\n            case 'program':\n              // Program change\n              /** @type {HTMLSelectElement|null} */\n              const select = doc.createElement('select');\n              select.className = 'form-control form-control-sm';\n\n              itemElem.appendChild(select);\n\n              select.addEventListener('change', ((synth, channelElem) => {\n                return (event) => {\n                  synth.programChange(channelElem, event.target.value);\n                };\n              })(this, channel), false);\n\n              select.selectedIndex = this.channelInstrument[item];\n              break;\n            case 'volume':\n              const volumeElem = document.createElement('var');\n              volumeElem.innerText = 100;\n              itemElem.appendChild(volumeElem);\n              break;\n            case 'pitchBendSensitivity':\n              const pitchSensElem = document.createElement('var');\n              pitchSensElem.innerText = 2;\n              itemElem.appendChild(pitchSensElem);\n              break;\n            case 'panpot':\n              /** @type {HTMLMeterElement|null} */\n              const panpot = doc.createElement('meter');\n              panpot.min = 1;\n              panpot.max = 127;\n              panpot.value = 64;\n              panpot.optimum = 64;\n              panpot.low = 63;\n              panpot.high = 65;\n              itemElem.appendChild(panpot);\n              break;\n            case 'pitchBend':\n              /** @type {HTMLMeterElement|null} */\n              const pitch = doc.createElement('meter');\n              pitch.min = -8192;\n              pitch.max = 8192;\n              pitch.low = -1;\n              pitch.high = 1;\n              pitch.optimum = 0;\n              pitch.value = 0;\n              itemElem.appendChild(pitch);\n              break;\n            case 'keys':\n              for (let key = 0; key < 127; key++) {\n                /** @type {HTMLDivElement|null} */\n                const keyElem = doc.createElement('div');\n                /** @type {number} */\n                const n = key % 12;\n                // \n                keyElem.className = 'key ' + ([1, 3, 6, 8, 10].includes(n) ? 'semitone' : 'tone');\n                itemElem.appendChild(keyElem);\n\n                // \n                keyElem.addEventListener(eventStart, ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    synth.drag = true;\n                    synth.noteOn(channelElem, k, 127);\n                  };\n                })(this, channel, key));\n                keyElem.addEventListener('mouseover', ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    if (synth.drag) {\n                      synth.noteOn(channelElem, k, 127);\n                    }\n                  };\n                })(this, channel, key));\n                keyElem.addEventListener('mouseout', ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    synth.noteOff(channelElem, k, 0);\n                  };\n                })(this, channel, key));\n                keyElem.addEventListener(eventEnd, ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    synth.drag = false;\n                    synth.noteOff(channelElem, k, 0);\n                  };\n                })(this, channel, key));\n              }\n              break;\n          }\n          channelElem.appendChild(itemElem);\n        }\n      }\n      instElem.appendChild(channelElem);\n      this.observer.observe(channelElem);\n    }\n    wrapper.appendChild(instElem);\n    return wrapper;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} key\n   * @param {number} velocity\n   */\n  updateSynthElement(channel, key, velocity) {\n    if (!this.element) {\n      return;\n    }\n    /** @type {HTMLDivElement} */\n    const channelElem = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ')');\n\n    if (channelElem.dataset.isIntersecting) {\n      /** @type {HTMLDivElement} */\n      const keyElem = channelElem.querySelector('.key:nth-child(' + (key + 1) + ')');\n      if (velocity === 0) {\n        if (keyElem.classList.contains('note-on')) {\n          keyElem.classList.remove('note-on');\n        }\n        keyElem.style.opacity = 1;\n      } else {\n        keyElem.classList.add('note-on');\n        keyElem.style.opacity = (velocity / 127).toFixed(2);\n      }\n    }\n  }\n\n  /**\n   * \n   * @param {number} channel\n   */\n  updateBankSelect(channel) {\n    if (!this.element) {\n      return;\n    }\n    /** @type {HTMLElement} */\n    const bankElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .bank > select');\n\n    while (bankElement.firstChild) bankElement.removeChild(bankElement.firstChild);\n\n    for (const bankNo in this.programSet) {\n      if ({}.hasOwnProperty.call(this.programSet, bankNo)) {\n        const option = document.createElement('option');\n        option.value = bankNo;\n        option.textContent = ('000' + (parseInt(bankNo))).slice(-3);\n        bankElement.appendChild(option);\n      }\n    }\n  }\n\n  /**\n   * \n   * @param {number} channel\n   */\n  updateProgramSelect(channel) {\n    if (!this.element) {\n      return;\n    }\n    /** @type {number} */\n    const bankIndex = this.channelBank[channel];\n    /** @type {HTMLElement} */\n    const bankElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .bank > select');\n    /** @type {HTMLElement} */\n    const programElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .program > select');\n\n    bankElement.value = this.channelBank[channel];\n    while (programElement.firstChild) programElement.removeChild(programElement.firstChild);\n\n    for (const programNo in this.programSet[bankIndex]) {\n      if ({}.hasOwnProperty.call(this.programSet[bankIndex], programNo)) {\n        // TODO: \n        const option = document.createElement('option');\n        option.value = programNo;\n        option.textContent = ('000' + (parseInt(programNo) + 1)).slice(-3) + ':' + this.programSet[bankIndex][programNo];\n        if (programNo === this.channelInstrument[channel]) {\n          option.selected = 'selected';\n        }\n        programElement.appendChild(option);\n      }\n    }\n  }\n\n  /**\n   * @param {number} channel NoteOn .\n   * @param {number} key NoteOn .\n   * @param {number} velocity .\n   */\n  noteOn(channel, key, velocity) {\n    /** @type {number} */\n    const bankIndex = this.channelBank[channel];\n    /** @type {Object} */\n    const bank = (typeof this.bankSet[bankIndex] === 'object') ? this.bankSet[bankIndex] : this.bankSet[0];\n    /** @type {Object} */\n    let instrument;\n\n    if (typeof bank[this.channelInstrument[channel]] === 'object') {\n      // \n      instrument = bank[this.channelInstrument[channel]];\n    } else if (this.percussionPart[channel] == true) {\n      // Standard Kit\n      instrument = this.bankSet[(this.isXG ? 127 : 128)][0];\n    } else {\n      // 0\n      instrument = this.bankSet[0][this.channelInstrument[channel]];\n    }\n\n    if (instrument[key] === void 0) {\n      // TODO\n      console.warn(\n        'instrument not found: bank=%s instrument=%s channel=%s key=%s',\n        bankIndex,\n        this.channelInstrument[channel],\n        channel,\n        key,\n      );\n      return;\n    }\n    /** @type {Object} */\n    const instrumentKey = instrument[key];\n    /** @type {number} */\n    let panpot = this.channelPanpot[channel] === 0 ? (Math.random()*127)|0 : this.channelPanpot[channel] - 64;\n    panpot /= panpot < 0 ? 64 : 63;\n\n    // create note information\n    instrumentKey['channel'] = channel;\n    instrumentKey['key'] = key;\n    instrumentKey['velocity'] = velocity;\n    instrumentKey['panpot'] = panpot;\n    instrumentKey['volume'] = this.channelVolume[channel] / 127;\n    instrumentKey['pitchBend'] = this.channelPitchBend[channel] - 8192;\n    instrumentKey['expression'] = this.channelExpression[channel];\n    instrumentKey['pitchBendSensitivity'] = Math.round(this.channelPitchBendSensitivity[channel]);\n    instrumentKey['mute'] = this.channelMute[channel];\n    instrumentKey['releaseTime'] = this.channelRelease[channel];\n    instrumentKey['cutOffFrequency'] = this.cutOffFrequency[channel];\n    instrumentKey['harmonicContent'] = this.harmonicContent[channel];\n    instrumentKey['reverb'] = this.reverb[channel];\n\n    // percussion\n    if (bankIndex > 125) {\n      if (key === 42 || key === 44) {\n        // 42: Closed Hi-Hat\n        // 44: Pedal Hi-Hat\n        // 46: Open Hi-Hat\n        this.noteOff(channel, 46, 0);\n      }\n      if (key === 80) {\n        // 80: Mute Triangle\n        // 81: Open Triangle\n        this.noteOff(channel, 81, 0);\n      }\n      instrument['volume'] *= this.percussionVolume[key] / 127;\n    }\n\n    // note on\n    /** @type {SynthesizerNote} */\n    const note = new SynthesizerNote(this.ctx, this.gainMaster, instrumentKey);\n    note.noteOn();\n    this.currentNoteOn[channel].push(note);\n\n    this.updateSynthElement(channel, key, velocity);\n  }\n\n  /**\n   * @param {number} channel NoteOff .\n   * @param {number} key NoteOff .\n   * @param {number} velocity .\n   */\n  noteOff(channel, key, velocity) {\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {SynthesizerNote} */\n    let note;\n    /** @type {boolean} */\n    const hold = this.channelHold[channel];\n\n    for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n      note = currentNoteOn[i];\n      if (note.key === key) {\n        note.noteOff();\n        // hold  NoteOff \n        if (!hold) {\n          note.release();\n          currentNoteOn.splice(i, 1);\n          --i;\n          --il;\n        }\n      }\n    }\n    this.updateSynthElement(channel, key, 0);\n  }\n\n  /**\n   * @param {number} channel \n   * @param {number} value \n   */\n  hold(channel, value) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {boolean} */\n    const hold = this.channelHold[channel] = !(value < 64);\n    /** @type {SynthesizerNote} */\n    let note;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    if (!hold) {\n      for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n        note = currentNoteOn[i];\n        if (note.isNoteOff()) {\n          note.release();\n          currentNoteOn.splice(i, 1);\n          --i;\n          --il;\n        }\n      }\n    }\n\n    if (this.element) {\n      /** @type {HTMLDivElement} */\n      const channelElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ')');\n      if (this.channelHold[channel]) {\n        channelElement.classList.add('hold');\n      } else {\n        channelElement.classList.remove('hold');\n      }\n    }\n  }\n\n  /**\n   * @param {number} channel MSB\n   * @param {number} value \n   */\n  bankSelectMsb(channel, value) {\n    if (this.isXG) {\n      // 0\n      this.channelBank[channel] = 0;\n      // XGMSBLSB\n      if (value === 64) {\n        // Bank Select MSB #64 (Voice Type: SFX)\n        this.channelBank[channel] = 125;\n        this.percussionPart[channel] = true;\n      } else if (value === 126 || value === 127) {\n        // Bank Select MSB #126 (Voice Type: Drum)\n        // Bank Select MSB #127 (Voice Type: Drum)\n        this.channelBank[channel] = value;\n        this.percussionPart[channel] = true;\n      }\n    } else if (this.isGS) {\n      // GS\n      // 10\n      this.channelBank[channel] = channel === 9 ? 128 : value;\n      this.percussionPart[channel] = value === 128;\n    } else {\n      // GM\n      return;\n    }\n    this.updateBankSelect(channel);\n  }\n\n  /**\n   * @param {number} channel LSB\n   * @param {number} value \n   */\n  bankSelectLsb(channel, value) {\n    // XG\n    if (!this.isXG || this.percussionPart[channel] === true) {\n      return;\n    }\n\n    // 125\n    this.percussionPart[channel] = value >= 125;\n\n    this.channelBank[channel] = value;\n    this.updateBankSelect(channel);\n  }\n\n  /**\n   * @param {number} channel .\n   * @param {number} instrument .\n   */\n  programChange(channel, instrument) {\n    this.channelInstrument[channel] = instrument;\n\n    this.bankChange(channel, this.channelBank[channel]);\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .program > select').value = instrument;\n    }\n  }\n\n  /**\n   * @param {number} channel .\n   * @param {number} bank .\n   */\n  bankChange(channel, bank) {\n    if (typeof this.bankSet[bank] === 'object') {\n      // \n      this.channelBank[channel] = bank;\n    } else {\n      // \n      if (this.percussionPart[channel]) {\n        // \n        this.channelBank[channel] = !this.isXG ? 128 : 127;\n      } else {\n        // 0\n        this.channelBank[channel] = 0;\n      }\n    }\n\n    // TODO: MIDI\n    this.updateProgramSelect(channel);\n\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .bank > select').value = bank;\n    }\n  }\n\n  /**\n   * @param {number} channel .\n   * @param {number} volume (0-127).\n   */\n  volumeChange(channel, volume) {\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .volume var').innerText = volume;\n    }\n\n    this.channelVolume[channel] = volume;\n  }\n\n  /**\n   * @param {number} channel .\n   * @param {number} expression (0-127).\n   */\n  expression(channel, expression) {\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n\n    for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n      currentNoteOn[i].updateExpression(expression);\n    }\n\n    this.channelExpression[channel] = expression;\n  }\n\n  /**\n   * @param {number} channel panpot .\n   * @param {number} panpot panpot(0-127).\n   */\n  panpotChange(channel, panpot) {\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .panpot > meter').value = panpot;\n    }\n\n    this.channelPanpot[channel] = panpot;\n  }\n\n  /**\n   * @param {number} channel panpot .\n   * @param {number} lowerByte\n   * @param {number} higherByte\n   */\n  pitchBend(channel, lowerByte, higherByte) {\n    /** @type {number} */\n    const bend = (lowerByte & 0x7f) | ((higherByte & 0x7f) << 7);\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {Array.<SoundFont.SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {number} */\n    const calculated = bend - 8192;\n\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .pitchBend > meter').value = calculated;\n    }\n\n    for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n      currentNoteOn[i].updatePitchBend(calculated);\n    }\n\n    this.channelPitchBend[channel] = bend;\n  }\n\n  /**\n   * @param {number} channel pitch bend sensitivity .\n   * @param {number} sensitivity\n   */\n  pitchBendSensitivity(channel, sensitivity) {\n    if (this.element) {\n      document.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .pitchBendSensitivity > var').innerText = sensitivity;\n    }\n    this.channelPitchBendSensitivity[channel] = sensitivity;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} attackTime\n   */\n  attackTime(channel, attackTime) {\n    this.channelAttack[channel] = attackTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} decayTime\n   */\n  decayTime(channel, decayTime) {\n    this.channelDecay[channel] = decayTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} sustinTime\n   */\n  sustinTime(channel, sustinTime) {\n    this.channelSustin[channel] = sustinTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} releaseTime\n   */\n  releaseTime(channel, releaseTime) {\n    this.channelRelease[channel] = releaseTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} value\n   */\n  harmonicContent(channel, value) {\n    this.channelHarmonicContent[channel] = value;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} value\n   */\n  cutOffFrequency(channel, value) {\n    this.channelCutOffFrequency[channel] = value;\n  }\n\n  /**\n   * \n   * @param {number} channel\n   * @param {number} depth\n   */\n  reverbDepth(channel, depth) {\n    // \n    this.reverb[channel].mix(depth / 127);\n  }\n\n  /**\n   * \n   * @param {number} channel\n   * @param {number} depth\n   */\n  modulationDepth(channel, depth) {\n    // TODO: LFO\n    // this.filter[channel].mix(depth / 127);\n  }\n\n  /**\n   * @param {number} channel pitch bend sensitivity .\n   * @return {number}\n   */\n  getPitchBendSensitivity(channel) {\n    return this.channelPitchBendSensitivity[channel];\n  }\n\n  /**\n   * @param {number} key\n   * @param {number} volume\n   */\n  drumInstrumentLevel(key, volume) {\n    this.percussionVolume[key] = volume;\n  }\n\n  /**\n   * @param {number} channel NoteOff .\n   */\n  allNoteOff(channel) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n\n    // \n    this.hold(channel, 0);\n\n    // \n    while (currentNoteOn.length > 0) {\n      this.noteOff(channel, currentNoteOn[0].key, 0);\n    }\n  }\n\n  /**\n   * @param {number} channel .\n   */\n  allSoundOff(channel) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {SynthesizerNote} */\n    let note;\n\n    while (currentNoteOn.length > 0) {\n      note = currentNoteOn.shift();\n      this.noteOff(channel, note.key, 0);\n      note.release();\n      note.disconnect();\n    }\n\n    // \n    this.hold(channel, 0);\n  }\n\n  /**\n   * @param {number} channel \n   */\n  resetAllControl(channel) {\n    this.allNoteOff(channel);\n    this.expression(channel, 127);\n    this.pitchBend(channel, 0x00, 0x40);\n  }\n\n  /**\n   * @param {number} channel .\n   * @param {boolean} mute  true.\n   */\n  mute(channel, mute) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    this.channelMute[channel] = mute;\n\n    if (mute) {\n      for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n        currentNoteOn[i].disconnect();\n      }\n    } else {\n      for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n        currentNoteOn[i].connect();\n      }\n    }\n  }\n\n  /**\n   * @param {number} channel TODO:\n   * @param {boolean} sw \n   */\n  setPercussionPart(channel, sw) {\n    if (!this.isXG) {\n      this.channelBank[channel] = 128;\n    } else {\n      this.channelBank[channel] = 127;\n    }\n    this.percussionPart[channel] = sw;\n  }\n}\n\nexport default Synthesizer;\n","/**\n * SynthesizerNote Class\n * @private\n */\nexport class SynthesizerNote {\n  /**\n   * @param {AudioContext} ctx\n   * @param {AudioNode} destination\n   * @param {{\n   *   channel: number,\n   *   key: number,\n   *   sample: Uint8Array,\n   *   basePlaybackRate: number,\n   *   loopStart: number,\n   *   loopEnd: number,\n   *   volume: number,\n   *   panpot: number\n   * }} instrument\n   */\n  constructor(ctx, destination, instrument) {\n    /** @type {AudioContext} */\n    this.ctx = ctx;\n    /** @type {AudioNode} */\n    this.destination = destination;\n    /** @type {{\n     *   channel: number,\n     *   key: number,\n     *   sample: Uint8Array,\n     *   basePlaybackRate: number,\n     *   loopStart: number,\n     *   loopEnd: number,\n     *   volume: number,\n     *   panpot: number\n     * }}\n     */\n    this.instrument = instrument;\n    /** @type {number} */\n    this.channel = instrument['channel'];\n    /** @type {number} */\n    this.key = instrument['key'];\n    /** @type {number} */\n    this.velocity = instrument['velocity'];\n    /** @type {Int16Array} */\n    this.buffer = instrument['sample'];\n    /** @type {number} */\n    this.playbackRate = instrument['basePlaybackRate'];\n    /** @type {number} */\n    this.loopStart = instrument['loopStart'];\n    /** @type {number} */\n    this.loopEnd = instrument['loopEnd'];\n    /** @type {number} */\n    this.sampleRate = instrument['sampleRate'];\n    /** @type {number} */\n    this.volume = instrument['volume'];\n    /** @type {number} */\n    this.panpot = instrument['panpot'];\n    /** @type {number} */\n    this.pitchBend = instrument['pitchBend'];\n    /** @type {number} */\n    this.pitchBendSensitivity = instrument['pitchBendSensitivity'];\n    /** @type {number} */\n    this.modEnvToPitch = instrument['modEnvToPitch'];\n    /** @type {number} */\n    this.expression = instrument['expression'];\n    /** @type {number} */\n    this.cutOffFrequency = instrument['cutOffFrequency'];\n    /** @type {number} */\n    this.hermonicContent = instrument['hermonicContent'];\n\n    /** @type {Reverb} */\n    this.reverb = instrument['reverb'];\n\n    // state\n    /** @type {number} */\n    this.startTime = ctx.currentTime;\n    /** @type {number} */\n    this.computedPlaybackRate = this.playbackRate | 0;\n    /** @type {boolean} */\n    this.noteOffState = false;\n\n    // ---------------------------------------------------------------------------\n    // audio node\n    // ---------------------------------------------------------------------------\n\n    /** @type {AudioBuffer} */\n    this.audioBuffer;\n    /** @type {AudioBufferSourceNode} */\n    this.bufferSource = ctx.createBufferSource();\n    /** @type {StereoPannerNode} */\n    this.panner = ctx.createPanner();\n    /** @type {GainNode} */\n    this.outputGainNode = ctx.createGain();\n    /** @type {GainNode} */\n    this.expressionGainNode = ctx.createGain();\n    /** @type {BiquadFilterNode} */\n    this.filter = ctx.createBiquadFilter();\n    /** @type {BiquadFilterNode} */\n    this.modulator = ctx.createBiquadFilter();\n  }\n\n  /**\n   */\n  noteOn() {\n    /** @type {AudioContext} */\n    const ctx = this.ctx;\n    /** @type {{\n     *   channel: number,\n     *   key: number,\n     *   sample: Uint8Array,\n     *   basePlaybackRate: number,\n     *   loopStart: number,\n     *   loopEnd: number,\n     *   volume: number,\n     *   panpot: number\n     * }} */\n    const instrument = this.instrument;\n    // console.log(instrument);\n    /** @type {number} */\n    const now = this.ctx.currentTime || 0;\n    /** @type {number} */\n    const volDelay = now + instrument['volDelay'];\n    /** @type {number} */\n    const modDelay = now + instrument['modDelay'];\n    /** @type {number} */\n    const volAttack = volDelay + instrument['volAttack'];\n    /** @type {number} */\n    const modAttack = volDelay + instrument['modAttack'];\n    /** @type {number} */\n    const volHold = volAttack + instrument['volHold'];\n    /** @type {number} */\n    const modHold = modAttack + instrument['modHold'];\n    /** @type {number} */\n    const volDecay = volHold + instrument['volDecay'];\n    /** @type {number} */\n    const modDecay = modHold + instrument['modDecay'];\n    /** @type {number} */\n    const loopStart = instrument['loopStart'] / this.sampleRate;\n    /** @type {number} */\n    const loopEnd = instrument['loopEnd'] / this.sampleRate;\n    /** @type {number} */\n    const startTime = instrument['start'] / this.sampleRate;\n    // TODO: Pan\n    // http://cpansearch.perl.org/src/PJB/MIDI-SoundFont-1.08/doc/sfspec21.html#8.4.6\n    /** @type {number} */\n    const pan = instrument['pan'] !== void 0 ? instrument['pan'] : this.panpot;\n\n    const sample = this.buffer.subarray(0, this.buffer.length + instrument['end']);\n    /** @type {AudioBuffer} */\n    const buffer = this.audioBuffer = ctx.createBuffer(1, sample.length, this.sampleRate);\n    /** @type {Float32Array} */\n    const channelData = buffer.getChannelData(0);\n    channelData.set(sample);\n\n    // buffer source\n    /** @type {AudioBufferSourceNode} */\n    const bufferSource = this.bufferSource;\n    bufferSource.buffer = buffer;\n    bufferSource.loop = instrument['sampleModes'] | 0 || 0;\n    bufferSource.loopStart = loopStart;\n    bufferSource.loopEnd = loopEnd;\n    this.updatePitchBend(this.pitchBend);\n\n    // Output\n    /** @type {GainNode} */\n    const output = this.outputGainNode;\n\n    // expression\n    this.expressionGainNode.gain.value = this.expression / 127;\n\n    // panpot\n    /** @type {StereoPannerNode} */\n    const panner = this.panner;\n    panner.panningModel = 'equalpower';\n    // panner.distanceModel = 'inverse';\n    panner.setPosition(\n      Math.sin(pan * Math.PI / 2),\n      0,\n      Math.cos(pan * Math.PI / 2),\n    );\n\n    // ---------------------------------------------------------------------------\n    // Delay, Attack, Hold, Decay, Sustain\n    // ---------------------------------------------------------------------------\n\n    /** @type {number} */\n    let volume = this.volume * (this.velocity / 127) * (1 - instrument['initialAttenuation'] / 1000);\n    if (volume < 0) {\n      volume = 0;\n    }\n\n    // volume envelope\n    /** @type {AudioNode} */\n    const outputGain = output.gain;\n    outputGain.setValueAtTime(0, now);\n    outputGain.setValueAtTime(0, volDelay);\n    outputGain.setTargetAtTime(volume, volDelay, instrument['volAttack']);\n    outputGain.setValueAtTime(volume, volHold);\n    outputGain.linearRampToValueAtTime(volume * (1 - instrument['volSustain']), volDecay);\n\n    // modulation envelope\n    /** @type {number} */\n    const baseFreq = this.amountToFreq(instrument['initialFilterFc']);\n    /** @type {number} */\n    const peekFreq = this.amountToFreq(instrument['initialFilterFc'] + instrument['modEnvToFilterFc']);\n    /** @type {number} */\n    const sustainFreq = baseFreq + (peekFreq - baseFreq) * (1 - instrument['modSustain']);\n\n    /** @type {BiquadFilterNode} */\n    const modulator = this.modulator;\n    modulator.Q.setValueAtTime(10 ** (instrument['initialFilterQ'] / 200), now);\n    modulator.frequency.value = baseFreq;\n    modulator.type = 'lowpass';\n    modulator.frequency.setTargetAtTime(baseFreq / 127, this.ctx.currentTime, 0.5);\n    modulator.frequency.setValueAtTime(baseFreq, now);\n    modulator.frequency.setValueAtTime(baseFreq, modDelay);\n    modulator.frequency.setTargetAtTime(peekFreq, modDelay, parseFloat(instrument['modAttack'] + 1)); // For FireFox fix\n    modulator.frequency.setValueAtTime(peekFreq, modHold);\n    modulator.frequency.linearRampToValueAtTime(sustainFreq, modDecay);\n\n    // connect\n    bufferSource.connect(modulator);\n    modulator.connect(panner);\n    panner.connect(this.expressionGainNode);\n\n    this.expressionGainNode.connect(output);\n\n    if (!instrument['mute']) {\n      this.connect();\n    }\n\n    // fire\n    bufferSource.start(0, startTime);\n  }\n\n  /**\n   * @param {number} val\n   * @return {number}\n   */\n  amountToFreq(val) {\n    return 2 ** ((val - 6900) / 1200) * 440;\n  }\n\n  /**\n   */\n  noteOff() {\n    this.noteOffState = true;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isNoteOff() {\n    return this.noteOffState;\n  }\n\n  /**\n   * @return {void}\n   */\n  release() {\n    /** @type {{\n     *   channel: number,\n     *   key: number,\n     *   sample: Uint8Array,\n     *   basePlaybackRate: number,\n     *   loopStart: number,\n     *   loopEnd: number,\n     *   volume: number,\n     *   panpot: number\n     * }} */\n    const instrument = this.instrument;\n    /** @type {AudioBufferSourceNode} */\n    const bufferSource = this.bufferSource;\n    /** @type {GainNode} */\n    const output = this.outputGainNode;\n    /** @type {number} */\n    const now = this.ctx.currentTime;\n    const release = instrument['releaseTime'] - 64;\n\n    // ---------------------------------------------------------------------------\n    // volume release time\n    // ---------------------------------------------------------------------------\n    /** @type {number} */\n    const volEndTimeTmp = instrument['volRelease'] * output.gain.value;\n    /** @type {number} */\n    const volEndTime = now + (volEndTimeTmp * (1 + release / (release < 0 ? 64 : 63)));\n    // var volEndTime = now + instrument['volRelease'] * (1 - instrument['volSustain']);\n\n    // ---------------------------------------------------------------------------\n    // modulation release time\n    // ---------------------------------------------------------------------------\n    /** @type {BiquadFilterNode} */\n    const modulator = this.modulator;\n    /** @type {number} */\n    const baseFreq = this.amountToFreq(instrument['initialFilterFc']);\n    /** @type {number} */\n    const peekFreq = this.amountToFreq(instrument['initialFilterFc'] + instrument['modEnvToFilterFc']);\n    /** @type {number} */\n    const modEndTime = now + instrument['modRelease'] *\n      (\n        baseFreq === peekFreq ?\n          1 :\n          (modulator.frequency.value - baseFreq) / (peekFreq - baseFreq)\n      );\n    // var modEndTime = now + instrument['modRelease'] * (1 - instrument['modSustain']);\n\n    if (!this.audioBuffer) {\n      return;\n    }\n\n    // ---------------------------------------------------------------------------\n    // Release\n    // ---------------------------------------------------------------------------\n\n    switch (instrument['sampleModes']) {\n      case 0:\n        // \n        bufferSource.loop = false;\n        bufferSource.disconnect();\n        bufferSource.buffer = null;\n        break;\n      case 1:\n        // \n        output.gain.cancelScheduledValues(0);\n        output.gain.setValueAtTime(output.gain.value, now);\n        output.gain.linearRampToValueAtTime(0, volEndTime);\n\n        modulator.frequency.cancelScheduledValues(0);\n        modulator.frequency.setValueAtTime(modulator.frequency.value, now);\n        modulator.frequency.linearRampToValueAtTime(baseFreq, modEndTime);\n\n        bufferSource.playbackRate.cancelScheduledValues(0);\n        bufferSource.playbackRate.setValueAtTime(bufferSource.playbackRate.value, now);\n        bufferSource.playbackRate.linearRampToValueAtTime(this.computedPlaybackRate, modEndTime);\n\n        bufferSource.stop(volEndTime);\n        break;\n      case 2:\n        // \n        console.error('detect unused sampleModes');\n        break;\n      case 3:\n        // \n        output.gain.cancelScheduledValues(0);\n        output.gain.setValueAtTime(output.gain.value, now);\n        output.gain.linearRampToValueAtTime(0, volEndTime);\n\n        modulator.frequency.cancelScheduledValues(0);\n        modulator.frequency.setValueAtTime(modulator.frequency.value, now);\n        modulator.frequency.linearRampToValueAtTime(baseFreq, modEndTime);\n\n        bufferSource.playbackRate.cancelScheduledValues(0);\n        bufferSource.playbackRate.setValueAtTime(bufferSource.playbackRate.value, now);\n        bufferSource.playbackRate.linearRampToValueAtTime(this.computedPlaybackRate, modEndTime);\n      default:\n        bufferSource.loop = false;\n        break;\n    }\n  }\n\n  /**\n   */\n  connect() {\n    this.reverb.connect(this.outputGainNode).connect(this.destination);\n  }\n\n  /**\n   */\n  disconnect() {\n    this.outputGainNode.disconnect(0);\n  }\n  /**\n   */\n  schedulePlaybackRate() {\n    const playbackRate = this.bufferSource.playbackRate;\n    /** @type {number} */\n    const computed = this.computedPlaybackRate;\n    /** @type {number} */\n    const start = this.startTime;\n    /** @type {Object} */\n    const instrument = this.instrument;\n    /** @type {number} */\n    const modAttack = start + instrument['modAttack'];\n    /** @type {number} */\n    const modDecay = modAttack + instrument['modDecay'];\n    /** @type {number} */\n    const peekPitch = computed *\n      1.0594630943592953 // Math.pow(2, 1 / 12)\n      **\n      (this.modEnvToPitch * this.instrument['scaleTuning']);\n\n    playbackRate.cancelScheduledValues(0);\n    playbackRate.setValueAtTime(computed, start);\n    playbackRate.linearRampToValueAtTime(peekPitch, modAttack);\n    playbackRate.linearRampToValueAtTime(computed + (peekPitch - computed) * (1 - instrument['modSustain']), modDecay);\n  }\n\n  /**\n   * @param {number} expression\n   */\n  updateExpression(expression) {\n    this.expressionGainNode.gain.value = (this.expression = expression) / 127;\n  }\n\n  /**\n   * @param {number} pitchBend\n   */\n  updatePitchBend(pitchBend) {\n    this.computedPlaybackRate = this.playbackRate * (\n      1.0594630943592953 // Math.pow(2, 1 / 12)\n      **\n      ((pitchBend / (pitchBend < 0 ? 8192 : 8191)) *\n        this.pitchBendSensitivity *\n        this.instrument['scaleTuning']));\n    this.schedulePlaybackRate();\n  }\n}\n\nexport default SynthesizerNote;\n","import Meta from './meta.js';\nimport Synthesizer from './sound_font_synth';\n\n/**\n * WebMidiLink Class\n */\nexport class WebMidiLink {\n  /**\n   * @param {object} option\n   */\n  constructor(option = {}) {\n    /** @type {Array.<number>} */\n    this.NrpnMsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.NrpnLsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.RpnMsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.RpnLsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {boolean} */\n    this.ready = false;\n    /** @type {Synthesizer} */\n    this.synth;\n    /** @type {function(ArrayBuffer)} */\n    this.loadCallback = () => { };\n    /** @type {Function} */\n    this.messageHandler = this.onmessage.bind(this);\n    /** @type {XMLHttpRequest} */\n    this.xhr;\n    /** @type {boolean} */\n    this.rpnMode = true;\n    /** @type {object} */\n    this.option = option;\n    /** @type {boolean} */\n    this.option.drawSynth = option.drawSynth !== void 0 ? option.drawSynth : true;\n    /** @type {boolean} */\n    this.option.cache = option.cache !== void 0 ? option.cache : true;\n    /** @type {HTMLElement} */\n    this.placeholder = option.placeholder !== void 0 ? document.getElementById(option.placeholder) : window.document.body;\n    /** @type {Window} */\n    this.opener;\n    /** @type {number} */\n    this.version = Meta.version;\n    /** @type {string} */\n    this.build = Meta.date;\n\n    // eslint-disable-next-line space-before-function-paren\n    window.addEventListener('DOMContentLoaded', function () {\n      this.ready = true;\n    }.bind(this), false);\n  };\n\n  /**\n   * @param {string} url\n   * @export\n   */\n  setup(url) {\n    /** @type {Window} */\n    const w = window;\n\n    if (!this.ready) {\n      w.addEventListener('DOMContentLoaded', function onload() {\n        w.removeEventListener('DOMContentLoaded', onload, false);\n        this.load(url);\n      }.bind(this), false);\n    } else {\n      this.load(url);\n    }\n\n    if (w.opener) {\n      this.opener = w.opener;\n    } else if (w.parent !== w) {\n      this.opener = w.parent;\n    }\n  }\n\n  /**\n   * @param {string} url\n   * @export\n   */\n  load(url) {\n    /** @type {Window} */\n    const opener = window.opener ? window.opener : window.parent;\n    /** @type {HtmlDIVElement} */\n    const loading = this.placeholder.appendChild(document.createElement('div'));\n    /** @type {HTMLStrongElement} */\n    const loadingText = loading.appendChild(document.createElement('p'));\n    /** @type {HTMLDivElement} */\n    const progress = loading.appendChild(document.createElement('div'));\n    progress.className = 'progress';\n    /** @type {HTMLDivElement} */\n    const progressBar = progress.appendChild(document.createElement('div'));\n    progressBar.className = 'progress-bar';\n    progressBar.role = 'progressbar';\n    /** @type {WebMidiLink} */\n    const self = this;\n\n    opener.postMessage('link,progress', '*');\n    loading.className = 'alert alert-warning';\n    loadingText.innerText = 'Now Loading...';\n\n    const promise = new Promise(resolve =>{ \n      if (this.option.cache && window.caches) {\n        // \n        loadingText.className = 'ml-1';\n        loading.className = 'd-flex';\n\n        window.caches.open('wml').then((cache) => {\n          cache\n            .match(url)\n            .then((response) => response.arrayBuffer())\n            .then((stream) => resolve(stream))\n            .catch(() => {\n              console.info('Fetch from server.');\n              fetch(url)\n                .then((response) => {\n                  if (!response.ok) {\n                    throw new Error('Network response was not ok.');\n                  }\n                  /** @type {number} */\n                  const total = response.headers.get('content-length') | 0;\n                  loadingText.innerText += ` (${total}bytes)`;\n                  /** @type {Response}  */\n                  const copy = response.clone();\n                  cache.put(url, response);\n                  return copy.arrayBuffer();\n                })\n                .then((stream) => resolve(stream))\n                // .catch((e) => {\n\n              // console.error(e);\n              // alert('There has been a problem with your fetch operation: ' + e.message);\n              //  )}\n              ;\n            });\n        });\n      } else {\n        // \n        console.info('This server/client does not cache function.');\n\n        // \n        const concatenation = (segments) => {\n          let sumLength = 0;\n          for (let i = 0; i < segments.length; ++i) {\n            sumLength += segments[i].byteLength;\n          }\n          const whole = new Uint8Array(sumLength);\n          let pos = 0;\n          for (let i = 0; i < segments.length; ++i) {\n            whole.set(new Uint8Array(segments[i]), pos);\n            pos += segments[i].byteLength;\n          }\n          return whole.buffer;\n        };\n\n        fetch(url)\n          .then((res) => {\n            // \n            const total = res.headers.get('content-length');\n            progress.max = total;\n\n            // body  reader \n            const reader = res.body.getReader();\n            let chunk = 0;\n            const buffer = [];\n            const processResult = (result) => {\n              // done  true  chunk\n              if (result.done) {\n                const stream = concatenation(buffer);\n                resolve(stream);\n                return;\n              }\n\n              // chunk  total \n              chunk += result.value.length;\n              buffer.push(result.value);\n              // \n              const percentage = Math.round((chunk / total) * 100);\n              progressBar.style.width = percentage + '%';\n              progressBar.innerText = percentage + ' %';\n              opener.postMessage('link,progress,' + chunk + ',' + total, '*');\n\n              // \n              return reader.read().then(processResult);\n            };\n            reader.read().then(processResult);\n          })\n          .catch((e) => alert('There has been a problem with your fetch operation: ' + e.message));\n      }\n    }).then(stream => {\n      console.info('ready');\n      loadingText.innerText = 'Parsing SoundFont...';\n      self.onload(stream);\n      loadingText.innerText = '';\n      if (typeof self.loadCallback === 'function') {\n        self.loadCallback(stream);\n      }\n      opener.postMessage('link,ready', '*');\n    });\n  }\n\n  /**\n   * @param {ArrayBuffer} response\n   */\n  onload(response) {\n    /** @type {Uint8Array} */\n    const input = new Uint8Array(response);\n\n    this.loadSoundFont(input);\n  }\n\n  /**\n   * @param {Uint8Array} input\n   */\n  loadSoundFont(input) {\n    /** @type {Window} */\n    const w = window;\n\n    if (!this.synth) {\n      // \n      //while (this.placeholder.firstChild) {\n      //  this.placeholder.removeChild(this.placeholder.firstChild);\n      //}\n      /** @type {Synthesizer} */\n      const synth = this.synth = new Synthesizer(input);\n      if (this.option.drawSynth) {\n        this.placeholder.appendChild(synth.drawSynth());\n      } else {\n        const readyElem = document.createElement('strong');\n        readyElem.innerText = 'Ready.';\n        this.placeholder.appendChild(readyElem);\n      }\n      synth.init();\n      synth.start();\n      w.addEventListener('message', this.messageHandler, false);\n    } else {\n      this.synth.refreshInstruments(input);\n    }\n\n    // link ready\n    w.postMessage('link,ready', '*');\n  };\n\n  /**\n   * @param {Event} ev\n   */\n  onmessage(ev) {\n    /** @type {Array} */\n    const msg = typeof ev.data.split === 'function' ? ev.data.split(',') : [];\n    /** @type {string} */\n    const type = msg !== [] ? msg.shift() : '';\n    /** @type {Window} */\n    const opener = window.opener ? window.opener : window.parent;\n    /** @type {string} */\n    let command;\n\n    switch (type) {\n      case 'midi':\n        this.processMidiMessage(msg.map((hex) => {\n          return parseInt(hex, 16);\n        }));\n        break;\n      case 'link':\n        if (opener === void 0) {\n          return;\n        }\n        command = msg.shift();\n        switch (command) {\n          case 'reqpatch':\n            // TODO: dummy data\n            opener.postMessage('link,patch', '*');\n            break;\n          case 'setpatch':\n          case 'ready':\n            opener.postMessage('link,ready', '*');\n            // TODO: NOP\n            break;\n          case 'progress':\n            opener.postMessage('link,progress', '*');\n            break;\n          default:\n            console.error('unknown link message:', command);\n            break;\n        }\n        break;\n      default:\n      // console.error('unknown message type');\n    }\n  };\n\n  /**\n   * @param {function(ArrayBuffer)} callback\n   * @export\n   */\n  setLoadCallback(callback) {\n    this.loadCallback = callback;\n  };\n\n  /**\n   * @param {Array.<number>} message\n   */\n  processMidiMessage(message) {\n    /** @type {number} */\n    const channel = message[0] & 0x0f;\n    /** @type {Synthesizer} */\n    const synth = this.synth;\n\n    switch (message[0] & 0xf0) {\n      case 0x80: // NoteOff: 8n kk vv\n        synth.noteOff(channel, message[1], message[2]);\n        break;\n      case 0x90: // NoteOn: 9n kk vv\n        if (message[2] > 0) {\n          synth.noteOn(channel, message[1], message[2]);\n        } else {\n          synth.noteOff(channel, message[1], 0);\n        }\n        break;\n      case 0xB0: // Control Change: Bn cc dd\n        /** @type {number} */\n        const value = message[2];\n        switch (message[1]) {\n          case 0x00: // Bank Select MSB: Bn 00 dd\n            synth.bankSelectMsb(channel, value);\n            break;\n          case 0x01: // Modulation Depth\n            synth.modulationDepth(channel, value);\n            break;\n          case 0x05: // Portament Time\n            break;\n          case 0x06: // Data Entry(MSB): Bn 06 dd\n            if (this.rpnMode) {\n              // RPN\n              switch (this.RpnMsb[channel]) {\n                case 0:\n                  switch (this.RpnLsb[channel]) {\n                    case 0: // Pitch Bend Sensitivity\n                      synth.pitchBendSensitivity(channel, value);\n                      break;\n                    case 1:\n                      // console.log(\"fine\");\n                      break;\n                    case 2:\n                      // console.log(\"coarse\");\n                      break;\n                    default:\n                      // console.log(\"default\");\n                      break;\n                  }\n                  break;\n                default:\n                  // console.log(\"default:\", this.RpnMsb[channel], this.RpnLsb[channel]);\n                  break;\n              }\n            } else {\n              // NRPN\n              switch (this.NrpnMsb[channel]) {\n                case 26: // Drum Instrument Level\n                  synth.drumInstrumentLevel(this.NrpnLsb[channel], value);\n                  break;\n                default:\n                  // console.log(\"default:\", this.RpnMsb[channel], this.RpnLsb[channel]);\n                  break;\n              }\n            }\n            break;\n          case 0x26: // Data Entry(LSB): Bn 26 dd\n            if (this.rpnMode) {\n              // RPN\n              switch (this.RpnMsb[channel]) {\n                case 0:\n                  switch (this.RpnLsb[channel]) {\n                    case 0: // Pitch Bend Sensitivity\n                      synth.pitchBendSensitivity(\n                        channel,\n                        synth.getPitchBendSensitivity(channel) + value / 100,\n                      );\n                      break;\n                    case 1:\n                      // console.log(\"fine\");\n                      break;\n                    case 2:\n                      // console.log(\"coarse\");\n                      break;\n                  }\n                  break;\n              }\n            }\n            // NRPN  LSB \n            break;\n          case 0x07: // Volume Change: Bn 07 dd\n            synth.volumeChange(channel, value);\n            break;\n          case 0x0A: // Panpot Change: Bn 0A dd\n            synth.panpotChange(channel, value);\n            break;\n          case 0x78: // All Sound Off: Bn 78 00\n            synth.allSoundOff(channel);\n            break;\n          case 0x79: // Reset All Control: Bn 79 00\n            synth.resetAllControl(channel);\n            break;\n          case 0x20: // BankSelect LSB: Bn 00 dd\n            synth.bankSelectLsb(channel, value);\n            break;\n          case 0x47: // Harmonic Content\n            synth.harmonicContent(channel, value);\n            break;\n          case 0x60: //\n            // console.log(60);\n            break;\n          case 0x61: //\n            // console.log(61);\n            break;\n          case 0x62: // NRPN LSB\n            this.rpnMode = false;\n            this.NrpnLsb[channel] = value;\n            break;\n          case 0x63: // NRPN MSB\n            this.rpnMode = false;\n            this.NrpnMsb[channel] = value;\n            break;\n          case 0x64: // RPN LSB\n            this.rpnMode = true;\n            this.RpnLsb[channel] = value;\n            break;\n          case 0x65: // RPN MSB\n            this.rpnMode = true;\n            this.RpnMsb[channel] = value;\n            break;\n          case 0x40: // Hold\n            synth.hold(channel, value);\n            break;\n          case 0x0b: // Expression\n            synth.expression(channel, value);\n            break;\n          case 0x48: // DecayTyme\n            synth.decayTime(channel, value);\n            break;\n          case 0x49: // ReleaseTime\n            synth.releaseTime(channel, value);\n            break;\n          case 0x4A: // Attack time\n            synth.attackTime(channel, value);\n            break;\n          case 0x4B: // Brightness\n            synth.cutOffFrequency(channel, value);\n            break;\n          case 0x5B: // Effect1 DepthReverb Send Level\n            synth.reverbDepth(channel, value);\n            break;\n          default:\n            // not supported\n            break;\n        }\n        break;\n      case 0xC0: // Program Change: Cn pp\n        synth.programChange(channel, message[1]);\n        break;\n      case 0xE0: // Pitch Bend\n        synth.pitchBend(channel, message[1], message[2]);\n        break;\n      case 0xf0: // System Exclusive Message\n        //   F0\n        //   [2]<vendor ID>\n        //   [3]<device ID>\n        //   [4]<sub ID 1>\n        //   [5]<sub ID 2>\n        //   [6]<size of parameter key>\n        //   [7]<size of parameter value>\n        //   [8]<MSB>\n        //   [9]<LSB>\n        //   [10]<data>\n        //   [11]<checksum> [IGNORE]\n        //   F7 EOX [IGNORE]\n\n        /** @type {number} Vendor ID (Roland=0x41 / YAMAHA=0x43 / Non Realtime=0x7E / Realtime=0x7F) */\n        const vendor = message[2];\n        /** @type {number} Device ID (GM extended=0x10 / =0x79 / Any=0x7F) */\n        const device = message[3];\n        /** @type {number} Sub ID 1 (Model ID: GM=0x09 / GS=0x42 / XG=0x4C) */\n        const subId1 = message[4];\n        /** @type {number} Sub ID 2 */\n        const subId2 = message[5];\n\n        // Gneral MIDI\n        // http://amei.or.jp/midistandardcommittee/Recommended_Practice/GM2_japanese.pdf\n\n        if (vendor === 0x7e && device === 0x09) {\n          // Non Realtime\n          switch (subId1) {\n            case 0x01:\n              // GM System On\n              synth.init('GM');\n              break;\n            case 0x02:\n              // GM System Off\n              // Ignore\n            case 0x03:\n              // GM2 System On\n              synth.init('GM2');\n              break;\n          }\n        } else if (vendor === 0x7f) {\n          // Realtime\n\n          // Through\n        }\n\n        // http://www.amei.or.jp/report/report4.html\n        if (vendor === 0x41) {\n          console.log('GS:', this.dumpMessage(message));\n          // GS\n          // http://lib.roland.co.jp/support/jp/manuals/res/1809974/SC-88VL_j.pdf\n          // F0 42 10 42 12 40 [part] [key] [value] [checksum] F7\n          // TODO\n          switch (message[8]) {\n            case 0x04:\n              // GS Master Volume: F0 41 10 42 12 40 00 04 [value] [checksum] F7\n              synth.setMasterVolume(message[9] << 7);\n              break;\n            case 0x7F:\n              // GS Reset: F0 41 10 42 12 40 00 7F 00 [checksum] F7\n              synth.init('GS');\n              console.info('GS Reset');\n              break;\n            case 0x15:\n              // GS Dram part: F0 41 10 42 12 40 1[part no] [Map] [checksum] F7\n              // Notice: [sum] is ignroe in this program.\n\n              const part = message[7] - 0x0F;\n              const map = message[8];\n              if (part === 0) {\n                // 10 Ch.\n                if (map !== 0x00) {\n                  synth.setPercussionPart(9, true);\n                } else {\n                  synth.setPercussionPart(9, false);\n                }\n              } else if (part >= 10) {\n                // 1~9 Ch.\n                if (map !== 0x00) {\n                  synth.setPercussionPart(part - 1, true);\n                } else {\n                  synth.setPercussionPart(part - 1, false);\n                }\n              } else {\n                // 11~16 Ch.\n                if (map !== 0x00) {\n                  synth.setPercussionPart(part, true);\n                } else {\n                  synth.setPercussionPart(part, false);\n                }\n              }\n              break;\n          }\n        } else if (vendor == 0x43) {\n          console.log('XG:', this.dumpMessage(message));\n          // XG\n          if (subId2 === 0x08) {\n            // XG Dram Part: F0 43 10 4C 08 [partNum] 07 [map] F7\n            // but there is no file to use much this parameter...\n            if (message[7] !== 0x00) { // [map]\n              synth.setPercussionPart(message[6], true);\n            } else {\n              synth.setPercussionPart(message[6], false);\n            }\n            // console.log(message);\n          }\n          switch (message[7]) {\n            case 0x04:\n              // XG Master Volume: F0 43 10 4C 00 00 04 [value] F7\n              synth.setMasterVolume((message[8] << 7) * 2);\n              // console.log(message[8] << 7);\n              break;\n            case 0x7E:\n              // XG Reset: F0 43 10 4C 00 00 7E 00 F7\n              synth.init('XG');\n              console.info('XG Reset');\n              break;\n          }\n        }\n\n        switch (device) {\n          case 0x04: // device control\n            // sub ID 2\n            switch (subId2) {\n              case 0x01: // master volume: F0 7F 7F 04 01 [value] [value] F7\n                synth.setMasterVolume(message[5] + (message[6] << 7));\n                break;\n            }\n            break;\n        }\n\n        break;\n      default: // not supported\n        synth.setPercussionPart(9, true);\n        break;\n    }\n  };\n\n  /**\n   * Dump System Exclusive Message\n   * @private\n   * @param {Array} message\n   */\n  dumpMessage(message) {\n    const ret = [];\n    for (const msg of message) {\n      ret.push(msg.toString(16).toUpperCase());\n    }\n    return ret.join(' ');\n  }\n}\n\nexport default WebMidiLink;\n"],"sourceRoot":""}